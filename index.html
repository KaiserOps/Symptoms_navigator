<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Smart Symptom Navigator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .click-zone {
      position: absolute;
      cursor: pointer;
      background: rgba(0, 255, 0, 0.10);
      border-radius: 8px;
      transition: box-shadow 0.2s, background 0.2s;
      z-index: 1;
    }
    .click-zone.selected, .click-zone.flash {
      background: rgba(34,197,94,0.45);
      border: 2px solid #84e291;
      box-shadow: 0 0 10px 3px #38b2ac55;
      z-index: 2;
      animation: flashSel 0.7s 1;
    }
    @keyframes flashSel {
      0% { box-shadow: 0 0 10px 6px #38b2ac88; }
      100% { box-shadow: 0 0 10px 1px #38b2ac55; }
    }
    .male-bg { background: radial-gradient(circle at 60% 20%, #e6f6ff 50px, #b6e0fe 300px, #0e2f44 100%);}
    .female-bg { background: radial-gradient(circle at 40% 70%, #ffe6fa 60px, #fbb6ce 300px, #3b133e 100%);}
    .neutral-bg { background: linear-gradient(135deg, #232526 0%, #414345 100%);}
    .modal-bg {background:rgba(0,0,0,0.60);}
    .modal {z-index:90;}
    .dashboard-modal {z-index:100;}
    .risk-badge {display:inline-block;padding:0.15em 0.7em;border-radius:1em;font-weight:bold;}
    .risk-low {background:#22c55e33;color:#22c55e;border:2px solid #22c55e;}
    .risk-med {background:#fde04788;color:#eab308;border:2px solid #eab308;}
    .risk-high{background:#ef444488;color:#ef4444;border:2px solid #ef4444;}
  </style>
</head>
<body class="neutral-bg min-h-screen text-gray-100 font-sans transition-colors duration-700">

<!-- Language Toggle -->
<div class="text-center my-3">
  <button onclick="setLanguage('en')" class="bg-blue-400 text-white px-3 py-1 rounded mx-1">English</button>
  <button onclick="setLanguage('hi')" class="bg-blue-400 text-white px-3 py-1 rounded mx-1">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</button>
  <button onclick="setLanguage('kn')" class="bg-blue-400 text-white px-3 py-1 rounded mx-1">‡≤ï‡≤®‡≥ç‡≤®‡≤°</button>
</div>

<header class="bg-white/10 dark:bg-white/10 backdrop-blur-md text-center py-6 shadow-md rounded-xl mx-auto mb-4 max-w-2xl">
  <h1 class="text-4xl font-extrabold text-green-400 dark:text-green-400 drop-shadow-md tracking-wide">
    <span data-i18n="appTitle">Symptom Navigator</span> ü©∫
  </h1>
  <p class="mt-2 italic text-blue-400 text-base" data-i18n="subtitle">Your smart step towards understanding your health</p>
</header>

<div id="gender-selection" class="text-center py-5">
  <h2 class="text-lg font-semibold mb-4" data-i18n="selectGender">Select Gender</h2>
  <button onclick="selectGender('male')" class="bg-green-500 hover:bg-green-600 transition-colors duration-200 text-white px-6 py-2 rounded-full mx-2 shadow-md">üë® <span data-i18n="male">Male</span></button>
  <button onclick="selectGender('female')" class="bg-pink-500 hover:bg-pink-600 transition-colors duration-200 text-white px-6 py-2 rounded-full mx-2 shadow-md">üë© <span data-i18n="female">Female</span></button>
</div>

<!-- Body Section -->
<div id="body-section" class="relative flex justify-center hidden mt-4">
  <img id="body-image" src="" alt="Body Model" class="max-w-xs rounded-2xl shadow-lg border-2 border-green-200 dark:border-green-700" />
  <!-- click-zones, ARMS ADDED -->
  <div class="click-zone" id="zone-Head" style="top: 13%; left: 44%; width: 12%; height: 10%;" onclick="zoneClicked('Head', event)"></div>
  <div class="click-zone" id="zone-Chest" style="top: 27%; left: 42%; width: 16%; height: 13%;" onclick="zoneClicked('Chest', event)"></div>
  <div class="click-zone" id="zone-Abdomen" style="top: 41%; left: 44%; width: 12%; height: 13%;" onclick="zoneClicked('Abdomen', event)"></div>
  <div class="click-zone" id="zone-Left-Leg" style="top: 62%; left: 30%; width: 12%; height: 24%;" onclick="zoneClicked('Left Leg', event)"></div>
  <div class="click-zone" id="zone-Right-Leg" style="top: 62%; left: 58%; width: 12%; height: 24%;" onclick="zoneClicked('Right Leg', event)"></div>
  <div class="click-zone" id="zone-Left-Arm" style="top: 29%; left: 30%; width: 10%; height: 26%;" onclick="zoneClicked('Left Arm', event)"></div>
  <div class="click-zone" id="zone-Right-Arm" style="top: 29%; left: 60%; width: 10%; height: 26%;" onclick="zoneClicked('Right Arm', event)"></div>
</div>

<div id="qa-modal" class="hidden fixed inset-0 modal-bg flex items-center justify-center z-50 modal">
  <div class="bg-gray-900/95 rounded-xl shadow-xl max-w-md w-full p-6 border border-green-600">
    <h2 class="text-lg mb-2 font-bold text-green-400" id="qa-title"></h2>
    <div id="qa-questions" class="mb-2"></div>
    <button onclick="closeQAModal()" class="mt-3 bg-red-500 hover:bg-red-600 px-4 py-2 rounded text-white">Close</button>
  </div>
</div>

<!-- Emergency Modal -->
<div id="emergency-modal" class="hidden fixed inset-0 modal-bg flex items-center justify-center z-[120]">
  <div class="bg-red-800/90 border-4 border-red-600 rounded-2xl p-10 text-center shadow-2xl max-w-sm">
    <div class="text-6xl animate-bounce mb-4">üö®</div>
    <h2 class="text-2xl font-bold mb-2 text-white">Emergency Detected!</h2>
    <p class="mb-4 text-lg text-red-100">Your answers indicate a possible medical emergency.<br> Please call emergency services or go to the nearest ER immediately.</p>
    <button onclick="closeEmergencyModal()" class="bg-white/80 hover:bg-white px-6 py-2 text-red-700 font-bold rounded">Close</button>
  </div>
</div>

<div id="output" class="text-center mt-6 text-lg font-medium"></div>

<!-- Doctor Dashboard Modal -->
<div id="doctor-dashboard" class="hidden fixed inset-0 modal-bg flex items-center justify-center dashboard-modal">
  <div class="bg-gray-900/95 p-6 rounded-xl w-full max-w-4xl shadow-2xl border border-green-700 overflow-auto max-h-[90vh]">
    <div class="flex justify-between items-center mb-2">
      <h2 class="text-2xl font-bold text-green-400" id="dashboard-title">Doctor Dashboard</h2>
      <button onclick="closeDoctorDashboard()" class="bg-red-500 hover:bg-red-700 text-white px-4 py-1 rounded">Close</button>
    </div>
    <div class="flex gap-2 mb-2 flex-wrap">
      <button onclick="exportAllCSV()" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm">Export All as CSV</button>
      <button onclick="exportAllJSON()" class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-1 rounded text-sm">Export All as JSON</button>
      <button onclick="deleteAllSessions()" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm">Delete All Data</button>
    </div>
    <div id="dashboard-list"></div>
  </div>
</div>
<!-- Doctor Session Detail Modal -->
<div id="doctor-session-detail" class="hidden fixed inset-0 modal-bg flex items-center justify-center z-[115]">
  <div class="bg-gray-900/95 rounded-xl shadow-xl max-w-xl w-full p-6 border border-green-600 overflow-auto max-h-[90vh]">
    <div class="flex justify-between items-center mb-2">
      <h2 class="text-xl font-bold text-green-400">Session Detail</h2>
      <button onclick="closeSessionDetail()" class="bg-red-500 hover:bg-red-700 text-white px-3 py-1 rounded">Close</button>
    </div>
    <div id="session-detail-content"></div>
  </div>
</div>
<!-- QR Code Modal -->
<div id="qr-modal" class="hidden fixed inset-0 modal-bg flex items-center justify-center z-[130]">
  <div class="bg-gray-800 p-6 rounded-xl border border-green-500 shadow-2xl text-center max-w-xs relative">
    <div class="mb-3 text-lg font-bold">Share Session via QR</div>
    <div id="qr-code"></div>
    <button onclick="closeQRModal()" class="mt-3 bg-red-500 hover:bg-red-600 text-white px-4 py-1 rounded">Close</button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
<script>
let currentLang = 'en';
let selectedGender = null;
let selectedZone = "";
let answers = {};
let sessionId = null;
let riskFlag = 'low';

// --- TRANSLATIONS (includes English, Hindi, Kannada) ---
const translations = {
  en: {
    appTitle: "Symptom Navigator",
    subtitle: "Your smart step towards understanding your health",
    selectGender: "Select Gender",
    male: "Male",
    female: "Female",
    start: "Start",
    doctorSummary: "Doctor View: Patient Report",
    close: "Close",
    submit: "Submit",
    next: "Next",
    speak: "üîä Read",
    mic: "üé§ Speak",
    summary: "Summary",
    specialist: "Specialist",
    tests: "Recommended Tests",
    action: "Triage Advice",
    followup: "Follow-up Q&A",
    selectedBodyPart: "Body Part",
    answer: "Answer",
    responses: "Responses",
    startOver: "Start Over",
    viewDoctorSummary: "View Doctor Summary",
    timestamp: "Time",
    wellnessTip: "Wellness Tip",
    pleaseAnswer: "Please answer all questions.",
    viewAllSessions: "View All Sessions",
    downloadPDF: "Download as PDF",
    doctorDashboard: "Doctor Dashboard",
    exportCSV: "Export All as CSV",
    exportJSON: "Export All as JSON",
    deleteAll: "Delete All Data",
    delete: "Delete",
    shareQR: "Share via QR"
  },
  hi: {
    appTitle: "‡§≤‡§ï‡•ç‡§∑‡§£ ‡§®‡•á‡§µ‡§ø‡§ó‡•á‡§ü‡§∞",
    subtitle: "‡§Ü‡§™‡§ï‡•á ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§ï‡•ã ‡§∏‡§Æ‡§ù‡§®‡•á ‡§ï‡•Ä ‡§ì‡§∞ ‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§ï‡§¶‡§Æ",
    selectGender: "‡§≤‡§ø‡§Ç‡§ó ‡§ö‡•Å‡§®‡•á‡§Ç",
    male: "‡§™‡•Å‡§∞‡•Å‡§∑",
    female: "‡§Æ‡§π‡§ø‡§≤‡§æ",
    start: "‡§™‡•ç‡§∞‡§æ‡§∞‡§Ç‡§≠ ‡§ï‡§∞‡•á‡§Ç",
    doctorSummary: "‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§¶‡•É‡§∂‡•ç‡§Ø: ‡§∞‡•ã‡§ó‡•Ä ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü",
    close: "‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç",
    submit: "‡§ú‡§Æ‡§æ ‡§ï‡§∞‡•á‡§Ç",
    next: "‡§Ü‡§ó‡•á",
    speak: "üîä ‡§™‡§¢‡§º‡•á‡§Ç",
    mic: "üé§ ‡§¨‡•ã‡§≤‡•á‡§Ç",
    summary: "‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂",
    specialist: "‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û",
    tests: "‡§Ö‡§®‡•Å‡§∂‡§Ç‡§∏‡§ø‡§§ ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£",
    action: "‡§§‡•ç‡§∞‡•à‡§ú ‡§∏‡§≤‡§æ‡§π",
    followup: "‡§´‡•â‡§≤‡•ã-‡§Ö‡§™ ‡§™‡•ç‡§∞‡§∂‡•ç‡§®",
    selectedBodyPart: "‡§∂‡§∞‡•Ä‡§∞ ‡§ï‡§æ ‡§π‡§ø‡§∏‡•ç‡§∏‡§æ",
    answer: "‡§â‡§§‡•ç‡§§‡§∞",
    responses: "‡§â‡§§‡•ç‡§§‡§∞",
    startOver: "‡§´‡§ø‡§∞ ‡§∏‡•á ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç",
    viewDoctorSummary: "‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂ ‡§¶‡•á‡§ñ‡•á‡§Ç",
    timestamp: "‡§∏‡§Æ‡§Ø",
    wellnessTip: "‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§∏‡•Å‡§ù‡§æ‡§µ",
    pleaseAnswer: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§™‡•ç‡§∞‡§∂‡•ç‡§®‡•ã‡§Ç ‡§ï‡§æ ‡§â‡§§‡•ç‡§§‡§∞ ‡§¶‡•á‡§Ç‡•§",
    viewAllSessions: "‡§∏‡§≠‡•Ä ‡§∏‡§§‡•ç‡§∞ ‡§¶‡•á‡§ñ‡•á‡§Ç",
    downloadPDF: "PDF ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç",
    doctorDashboard: "‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°",
    exportCSV: "CSV ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§ ‡§ï‡§∞‡•á‡§Ç",
    exportJSON: "JSON ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§ ‡§ï‡§∞‡•á‡§Ç",
    deleteAll: "‡§∏‡§æ‡§∞‡§æ ‡§°‡•á‡§ü‡§æ ‡§π‡§ü‡§æ‡§è‡§Å",
    delete: "‡§π‡§ü‡§æ‡§è‡§Å",
    shareQR: "QR ‡§ï‡•á ‡§ú‡§º‡§∞‡§ø‡§è ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡•á‡§Ç"
  },
  kn: {
    appTitle: "‡≤≤‡≤ï‡≥ç‡≤∑‡≤£ ‡≤®‡≥ç‡≤Ø‡≤æ‡≤µ‡≤ø‡≤ó‡≥á‡≤ü‡≤∞‡≥ç",
    subtitle: "‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤Ü‡≤∞‡≥ã‡≤ó‡≥ç‡≤Ø‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤Ö‡≤∞‡≥ç‡≤•‡≤Æ‡≤æ‡≤°‡≤ø‡≤ï‡≥ä‡≤≥‡≥ç‡≤≥‡≤≤‡≥Å ‡≤∏‡≥ç‡≤Æ‡≤æ‡≤∞‡≥ç‡≤ü‡≥ç ‡≤π‡≥Ü‡≤ú‡≥ç‡≤ú‡≥Ü",
    selectGender: "‡≤≤‡≤ø‡≤Ç‡≤ó ‡≤Ü‡≤Ø‡≥ç‡≤ï‡≥Ü‡≤Æ‡≤æ‡≤°‡≤ø",
    male: "‡≤™‡≥Å‡≤∞‡≥Å‡≤∑",
    female: "‡≤π‡≥Ü‡≤£‡≥ç‡≤£‡≥Å",
    start: "‡≤™‡≥ç‡≤∞‡≤æ‡≤∞‡≤Ç‡≤≠‡≤ø‡≤∏‡≤ø",
    doctorSummary: "‡≤°‡≤æ‡≤ï‡≥ç‡≤ü‡≤∞‡≥ç ‡≤µ‡≥Ä‡≤ï‡≥ç‡≤∑‡≤£‡≥Ü: ‡≤∞‡≥ã‡≤ó‡≤ø‡≤Ø ‡≤µ‡≤∞‡≤¶‡≤ø",
    close: "‡≤Æ‡≥Å‡≤ö‡≥ç‡≤ö‡≤ø",
    submit: "‡≤∏‡≤≤‡≥ç‡≤≤‡≤ø‡≤∏‡≤ø",
    next: "‡≤Æ‡≥Å‡≤Ç‡≤¶‡≥Ü",
    speak: "üîä ‡≤ì‡≤¶‡≤ø",
    mic: "üé§ ‡≤Æ‡≤æ‡≤§‡≤®‡≤æ‡≤°‡≤ø",
    summary: "‡≤∏‡≤æ‡≤∞‡≤æ‡≤Ç‡≤∂",
    specialist: "‡≤µ‡≤ø‡≤∂‡≥á‡≤∑‡≤ú‡≥ç‡≤û",
    tests: "‡≤∂‡≤ø‡≤´‡≤æ‡≤∞‡≤∏‡≥Å ‡≤Æ‡≤æ‡≤°‡≤ø‡≤¶ ‡≤™‡≤∞‡≥Ä‡≤ï‡≥ç‡≤∑‡≥Ü‡≤ó‡≤≥‡≥Å",
    action: "‡≤ü‡≥ç‡≤∞‡≤Ø‡≤æ‡≤ú‡≥ç ‡≤∏‡≤≤‡≤π‡≥Ü",
    followup: "‡≤Ö‡≤®‡≥Å‡≤∏‡≤∞‡≤ø‡≤∏‡≤ø ‡≤™‡≥ç‡≤∞‡≤∂‡≥ç‡≤®‡≥Ü‡≤ó‡≤≥‡≥Å",
    selectedBodyPart: "‡≤¶‡≥á‡≤π‡≤¶ ‡≤≠‡≤æ‡≤ó",
    answer: "‡≤â‡≤§‡≥ç‡≤§‡≤∞",
    responses: "‡≤™‡≥ç‡≤∞‡≤§‡≥ç‡≤Ø‡≥Å‡≤§‡≥ç‡≤§‡≤∞‡≤ó‡≤≥‡≥Å",
    startOver: "‡≤Æ‡≤§‡≥ç‡≤§‡≥Ü ‡≤™‡≥ç‡≤∞‡≤æ‡≤∞‡≤Ç‡≤≠‡≤ø‡≤∏‡≤ø",
    viewDoctorSummary: "‡≤°‡≤æ‡≤ï‡≥ç‡≤ü‡≤∞‡≥ç ‡≤∏‡≤æ‡≤∞‡≤æ‡≤Ç‡≤∂‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤®‡≥ã‡≤°‡≤ø",
    timestamp: "‡≤∏‡≤Æ‡≤Ø",
    wellnessTip: "‡≤Ü‡≤∞‡≥ã‡≤ó‡≥ç‡≤Ø ‡≤∏‡≤≤‡≤π‡≥Ü",
    pleaseAnswer: "‡≤¶‡≤Ø‡≤µ‡≤ø‡≤ü‡≥ç‡≤ü‡≥Å ‡≤é‡≤≤‡≥ç‡≤≤‡≤æ ‡≤™‡≥ç‡≤∞‡≤∂‡≥ç‡≤®‡≥Ü‡≤ó‡≤≥‡≤ø‡≤ó‡≥Ü ‡≤â‡≤§‡≥ç‡≤§‡≤∞‡≤ø‡≤∏‡≤ø.",
    viewAllSessions: "‡≤é‡≤≤‡≥ç‡≤≤‡≤æ ‡≤∏‡≥Ü‡≤∑‡≤®‡≥ç‚Äå‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤®‡≥ã‡≤°‡≤ø",
    downloadPDF: "PDF ‡≤°‡≥å‡≤®‡≥ç‚Äå‡≤≤‡≥ã‡≤°‡≥ç ‡≤Æ‡≤æ‡≤°‡≤ø",
    doctorDashboard: "‡≤°‡≤æ‡≤ï‡≥ç‡≤ü‡≤∞‡≥ç ‡≤°‡≥ç‡≤Ø‡≤æ‡≤∂‡≥ç‚Äå‡≤¨‡≥ã‡≤∞‡≥ç‡≤°‡≥ç",
    exportCSV: "CSV ‡≤Ü‡≤ó‡≤ø ‡≤é‡≤ï‡≥ç‡≤∏‡≥ç‡≤™‡≥ã‡≤∞‡≥ç‡≤ü‡≥ç ‡≤Æ‡≤æ‡≤°‡≤ø",
    exportJSON: "JSON ‡≤Ü‡≤ó‡≤ø ‡≤é‡≤ï‡≥ç‡≤∏‡≥ç‡≤™‡≥ã‡≤∞‡≥ç‡≤ü‡≥ç ‡≤Æ‡≤æ‡≤°‡≤ø",
    deleteAll: "‡≤é‡≤≤‡≥ç‡≤≤‡≤æ ‡≤°‡≥á‡≤ü‡≤æ‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤Ö‡≤≥‡≤ø‡≤∏‡≤ø",
    delete: "‡≤Ö‡≤≥‡≤ø‡≤∏‡≤ø",
    shareQR: "QR ‡≤Æ‡≥Ç‡≤≤‡≤ï ‡≤π‡≤Ç‡≤ö‡≤ø‡≤ï‡≥ä‡≤≥‡≥ç‡≤≥‡≤ø"
  }
};

const questionsPerZone = {
  Head: {
    en: [
      "Do you have a headache?",
      "Is there dizziness or blurred vision?",
      "Do you feel nausea?"
    ],
    hi: [
      "‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™‡§ï‡•ã ‡§∏‡§ø‡§∞‡§¶‡§∞‡•ç‡§¶ ‡§π‡•à?",
      "‡§ï‡•ç‡§Ø‡§æ ‡§ö‡§ï‡•ç‡§ï‡§∞ ‡§Ø‡§æ ‡§ß‡•Å‡§Ç‡§ß‡§≤‡•Ä ‡§¶‡•É‡§∑‡•ç‡§ü‡§ø ‡§π‡•à?",
      "‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™‡§ï‡•ã ‡§â‡§≤‡•ç‡§ü‡•Ä ‡§ú‡•à‡§∏‡§æ ‡§≤‡§ó ‡§∞‡§π‡§æ ‡§π‡•à?"
    ],
    kn: [
      "‡≤®‡≤ø‡≤Æ‡≤ó‡≥Ü ‡≤§‡≤≤‡≥Ü‡≤®‡≥ã‡≤µ‡≤ø‡≤¶‡≥Ü‡≤Ø‡≥Ü?",
      "‡≤ö‡≤ï‡≥ç‡≤∞‡≤µ‡≤æ‡≤§ ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤Æ‡≤Ç‡≤ï‡≤æ‡≤¶ ‡≤¶‡≥É‡≤∑‡≥ç‡≤ü‡≤ø‡≤Ø‡≤ø‡≤¶‡≥Ü‡≤Ø‡≥Ü?",
      "‡≤®‡≤ø‡≤Æ‡≤ó‡≥Ü ‡≤µ‡≤æ‡≤Ç‡≤§‡≤ø ‡≤¨‡≤∞‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤¶‡≥Ü‡≤Ø‡≥Ü?"
    ]
  },
  Chest: {
    en: [
      "Do you feel chest pain?",
      "Is there any shortness of breath?",
      "Do you have cough or palpitations?"
    ],
    hi: [
      "‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™‡§ï‡•ã ‡§∏‡•Ä‡§®‡•á ‡§Æ‡•á‡§Ç ‡§¶‡§∞‡•ç‡§¶ ‡§π‡•à?",
      "‡§ï‡•ç‡§Ø‡§æ ‡§∏‡§æ‡§Ç‡§∏ ‡§´‡•Ç‡§≤ ‡§∞‡§π‡•Ä ‡§π‡•à?",
      "‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™‡§ï‡•ã ‡§ñ‡§æ‡§Å‡§∏‡•Ä ‡§Ø‡§æ ‡§ß‡§°‡§º‡§ï‡§® ‡§§‡•á‡§ú‡§º ‡§π‡•à?"
    ],
    kn: [
      "‡≤®‡≤ø‡≤Æ‡≤ó‡≥Ü ‡≤é‡≤¶‡≥Ü‡≤®‡≥ã‡≤µ‡≥Å ‡≤á‡≤¶‡≥Ü‡≤Ø‡≥Ü?",
      "‡≤â‡≤∏‡≤ø‡≤∞‡≤æ‡≤ü‡≤¶‡≤≤‡≥ç‡≤≤‡≤ø ‡≤§‡≥ä‡≤Ç‡≤¶‡≤∞‡≥Ü ‡≤á‡≤¶‡≥Ü‡≤Ø‡≥Ü?",
      "‡≤®‡≤ø‡≤Æ‡≤ó‡≥Ü ‡≤ï‡≥Ü‡≤Æ‡≥ç‡≤Æ‡≥Å ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤π‡≥É‡≤¶‡≤Ø ‡≤ß‡≤™‡≤ß‡≤™ ‡≤á‡≤¶‡≥Ü?"
    ]
  },
  Abdomen: {
    en: [
      "Do you have stomach pain?",
      "Is there any bloating or vomiting?",
      "Any change in bowel habits?"
    ],
    hi: [
      "‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™‡§ï‡•ã ‡§™‡•á‡§ü ‡§Æ‡•á‡§Ç ‡§¶‡§∞‡•ç‡§¶ ‡§π‡•à?",
      "‡§ï‡•ç‡§Ø‡§æ ‡§∏‡•Ç‡§ú‡§® ‡§Ø‡§æ ‡§â‡§≤‡•ç‡§ü‡•Ä ‡§π‡•à?",
      "‡§ï‡•ç‡§Ø‡§æ ‡§Æ‡§≤‡§§‡•ç‡§Ø‡§æ‡§ó ‡§ï‡•Ä ‡§Ü‡§¶‡§§‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤‡§æ‡§µ ‡§π‡•à?"
    ],
    kn: [
      "‡≤®‡≤ø‡≤Æ‡≤ó‡≥Ü ‡≤π‡≥ä‡≤ü‡≥ç‡≤ü‡≥Ü‡≤®‡≥ã‡≤µ‡≥Å ‡≤á‡≤¶‡≥Ü‡≤Ø‡≥Ü?",
      "‡≤â‡≤¨‡≥ç‡≤¨‡≥Å ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤µ‡≤æ‡≤Ç‡≤§‡≤ø ‡≤á‡≤¶‡≥Ü‡≤Ø‡≥Ü?",
      "‡≤Æ‡≤≤‡≤¶ ‡≤Ö‡≤≠‡≥ç‡≤Ø‡≤æ‡≤∏‡≤¶‡≤≤‡≥ç‡≤≤‡≤ø ‡≤¨‡≤¶‡≤≤‡≤æ‡≤µ‡≤£‡≥Ü ‡≤á‡≤¶‡≥Ü‡≤Ø‡≥Ü?"
    ]
  },
  "Left Leg": {
    en: [
      "Is there pain or swelling in the left leg?",
      "Do you feel numbness or tingling?",
      "Is it difficult to walk?"
    ],
    hi: [
      "‡§ï‡•ç‡§Ø‡§æ ‡§¨‡§æ‡§è‡§Å ‡§™‡•à‡§∞ ‡§Æ‡•á‡§Ç ‡§¶‡§∞‡•ç‡§¶ ‡§Ø‡§æ ‡§∏‡•Ç‡§ú‡§® ‡§π‡•à?",
      "‡§ï‡•ç‡§Ø‡§æ ‡§ù‡§®‡§ù‡§®‡§æ‡§π‡§ü ‡§Ø‡§æ ‡§∏‡•Å‡§®‡•ç‡§®‡§™‡§® ‡§π‡•à?",
      "‡§ö‡§≤‡§®‡•á ‡§Æ‡•á‡§Ç ‡§ï‡§†‡§ø‡§®‡§æ‡§à ‡§π‡•à?"
    ],
    kn: [
      "‡≤é‡≤° ‡≤ï‡≤æ‡≤≤‡≤ø‡≤®‡≤≤‡≥ç‡≤≤‡≤ø ‡≤®‡≥ã‡≤µ‡≥Å ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤â‡≤¨‡≥ç‡≤¨‡≥Å ‡≤á‡≤¶‡≥Ü‡≤Ø‡≥Ü?",
      "‡≤ö‡≥Å‡≤Æ‡≥Å‡≤ö‡≥Å‡≤Æ‡≥Å ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤∏‡≥Å‡≤®‡≥ç‡≤®‡≤æ‡≤ó‡≤ø‡≤∞‡≥Å‡≤µ‡≥Å‡≤¶‡≥á?",
      "‡≤®‡≤°‡≥Ü‡≤µ‡≥Å‡≤¶‡≤∞‡≤≤‡≥ç‡≤≤‡≤ø ‡≤§‡≥ä‡≤Ç‡≤¶‡≤∞‡≥Ü ‡≤á‡≤¶‡≥Ü‡≤Ø‡≥Ü?"
    ]
  },
  "Right Leg": {
    en: [
      "Is there pain or swelling in the right leg?",
      "Do you feel numbness or tingling?",
      "Is it difficult to walk?"
    ],
    hi: [
      "‡§ï‡•ç‡§Ø‡§æ ‡§¶‡§æ‡§è‡§Å ‡§™‡•à‡§∞ ‡§Æ‡•á‡§Ç ‡§¶‡§∞‡•ç‡§¶ ‡§Ø‡§æ ‡§∏‡•Ç‡§ú‡§® ‡§π‡•à?",
      "‡§ï‡•ç‡§Ø‡§æ ‡§ù‡§®‡§ù‡§®‡§æ‡§π‡§ü ‡§Ø‡§æ ‡§∏‡•Å‡§®‡•ç‡§®‡§™‡§® ‡§π‡•à?",
      "‡§ö‡§≤‡§®‡•á ‡§Æ‡•á‡§Ç ‡§ï‡§†‡§ø‡§®‡§æ‡§à ‡§π‡•à?"
    ],
    kn: [
      "‡≤¨‡≤≤ ‡≤ï‡≤æ‡≤≤‡≤ø‡≤®‡≤≤‡≥ç‡≤≤‡≤ø ‡≤®‡≥ã‡≤µ‡≥Å ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤â‡≤¨‡≥ç‡≤¨‡≥Å ‡≤á‡≤¶‡≥Ü‡≤Ø‡≥Ü?",
      "‡≤ö‡≥Å‡≤Æ‡≥Å‡≤ö‡≥Å‡≤Æ‡≥Å ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤∏‡≥Å‡≤®‡≥ç‡≤®‡≤æ‡≤ó‡≤ø‡≤∞‡≥Å‡≤µ‡≥Å‡≤¶‡≥á?",
      "‡≤®‡≤°‡≥Ü‡≤µ‡≥Å‡≤¶‡≤∞‡≤≤‡≥ç‡≤≤‡≤ø ‡≤§‡≥ä‡≤Ç‡≤¶‡≤∞‡≥Ü ‡≤á‡≤¶‡≥Ü‡≤Ø‡≥Ü?"
    ]
  },
  "Left Arm": {
    en: [
      "Is there pain or weakness in the left arm?",
      "Any tingling or numbness?",
      "Recent injury or overuse?"
    ],
    hi: [
      "‡§ï‡•ç‡§Ø‡§æ ‡§¨‡§æ‡§è‡§Å ‡§π‡§æ‡§• ‡§Æ‡•á‡§Ç ‡§¶‡§∞‡•ç‡§¶ ‡§Ø‡§æ ‡§ï‡§Æ‡§ú‡•ã‡§∞‡•Ä ‡§π‡•à?",
      "‡§ï‡•ç‡§Ø‡§æ ‡§ù‡§®‡§ù‡§®‡§æ‡§π‡§ü ‡§Ø‡§æ ‡§∏‡•Å‡§®‡•ç‡§®‡§™‡§® ‡§π‡•à?",
      "‡§π‡§æ‡§≤ ‡§π‡•Ä ‡§Æ‡•á‡§Ç ‡§ö‡•ã‡§ü ‡§Ø‡§æ ‡§Ö‡§ß‡§ø‡§ï ‡§â‡§™‡§Ø‡•ã‡§ó ‡§π‡•Å‡§Ü?"
    ],
    kn: [
      "‡≤é‡≤° ‡≤ï‡≥à‡≤Ø‡≤≤‡≥ç‡≤≤‡≤ø ‡≤®‡≥ã‡≤µ‡≥Å ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤¶‡≥Å‡≤∞‡≥ç‡≤¨‡≤≤‡≤§‡≥Ü ‡≤á‡≤¶‡≥Ü‡≤Ø‡≥Ü?",
      "‡≤ö‡≥Å‡≤Æ‡≥Å‡≤ö‡≥Å‡≤Æ‡≥Å ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤∏‡≥Å‡≤®‡≥ç‡≤®‡≤æ‡≤ó‡≤ø‡≤∞‡≥Å‡≤µ‡≥Å‡≤¶‡≥á?",
      "‡≤á‡≤§‡≥ç‡≤§‡≥Ä‡≤ö‡≥Ü‡≤ó‡≥Ü ‡≤ó‡≤æ‡≤Ø ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤π‡≥Ü‡≤ö‡≥ç‡≤ö‡≤ø‡≤® ‡≤¨‡≤≥‡≤ï‡≥Ü ‡≤á‡≤¶‡≥Ü‡≤Ø‡≥Ü?"
    ]
  },
  "Right Arm": {
    en: [
      "Is there pain or weakness in the right arm?",
      "Any tingling or numbness?",
      "Recent injury or overuse?"
    ],
    hi: [
      "‡§ï‡•ç‡§Ø‡§æ ‡§¶‡§æ‡§è‡§Å ‡§π‡§æ‡§• ‡§Æ‡•á‡§Ç ‡§¶‡§∞‡•ç‡§¶ ‡§Ø‡§æ ‡§ï‡§Æ‡§ú‡•ã‡§∞‡•Ä ‡§π‡•à?",
      "‡§ï‡•ç‡§Ø‡§æ ‡§ù‡§®‡§ù‡§®‡§æ‡§π‡§ü ‡§Ø‡§æ ‡§∏‡•Å‡§®‡•ç‡§®‡§™‡§® ‡§π‡•à?",
      "‡§π‡§æ‡§≤ ‡§π‡•Ä ‡§Æ‡•á‡§Ç ‡§ö‡•ã‡§ü ‡§Ø‡§æ ‡§Ö‡§ß‡§ø‡§ï ‡§â‡§™‡§Ø‡•ã‡§ó ‡§π‡•Å‡§Ü?"
    ],
    kn: [
      "‡≤¨‡≤≤ ‡≤ï‡≥à‡≤Ø‡≤≤‡≥ç‡≤≤‡≤ø ‡≤®‡≥ã‡≤µ‡≥Å ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤¶‡≥Å‡≤∞‡≥ç‡≤¨‡≤≤‡≤§‡≥Ü ‡≤á‡≤¶‡≥Ü‡≤Ø‡≥Ü?",
      "‡≤ö‡≥Å‡≤Æ‡≥Å‡≤ö‡≥Å‡≤Æ‡≥Å ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤∏‡≥Å‡≤®‡≥ç‡≤®‡≤æ‡≤ó‡≤ø‡≤∞‡≥Å‡≤µ‡≥Å‡≤¶‡≥á?",
      "‡≤á‡≤§‡≥ç‡≤§‡≥Ä‡≤ö‡≥Ü‡≤ó‡≥Ü ‡≤ó‡≤æ‡≤Ø ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤π‡≥Ü‡≤ö‡≥ç‡≤ö‡≤ø‡≤® ‡≤¨‡≤≥‡≤ï‡≥Ü ‡≤á‡≤¶‡≥Ü‡≤Ø‡≥Ü?"
    ]
  }
};

// --- SPEECH SYNTHESIS (VOICE READ) ---
function speakText(elementId) {
  const text = document.getElementById(elementId).innerText;
  speak(text);
}
function speakAllQuestions() {
  const zone = selectedZone;
  if (!zone) return;
  const qList = questionsPerZone[zone][currentLang] || questionsPerZone[zone].en;
  speak(qList.join('. '));
}
function speak(text) {
  if (window.speechSynthesis.speaking) {
    window.speechSynthesis.cancel();
  }
  const utter = new window.SpeechSynthesisUtterance(text);
  if (currentLang === 'hi') utter.lang = 'hi-IN';
  else if (currentLang === 'kn') utter.lang = 'kn-IN';
  else utter.lang = 'en-US';
  utter.rate = 0.95;
  window.speechSynthesis.speak(utter);
}

function setLanguage(lang) {
  currentLang = lang;
  document.querySelectorAll("[data-i18n]").forEach(el => {
    const key = el.dataset.i18n;
    if (translations[lang][key]) el.textContent = translations[lang][key];
  });
  // If Q/A modal open, re-render it in new language
  if (selectedZone && !document.getElementById("qa-modal").classList.contains("hidden")) {
    showQAModal(selectedZone);
  }
}

function selectGender(gender) {
  selectedGender = gender;
  document.body.classList.remove("neutral-bg", "male-bg", "female-bg");
  if (gender === "male") {
    document.body.classList.add("male-bg");
    document.getElementById("body-image").src = "https://i.postimg.cc/c4SPF0Gj/IMG-20250613-WA0005.jpg";
  } else {
    document.body.classList.add("female-bg");
    document.getElementById("body-image").src = "https://i.postimg.cc/hjBgqx78/24469993-realistic-front-muscles-of-woman-isolated-in-white-background.jpg";
  }
  document.getElementById("gender-selection").classList.add("hidden");
  document.getElementById("body-section").classList.remove("hidden");
}

function zoneClicked(zone, e) {
  selectedZone = zone;
  animateClickZone(zone);
  showQAModal(zone);
}
function animateClickZone(zone) {
  document.querySelectorAll('.click-zone').forEach(z=>z.classList.remove('selected','flash'));
  const el = document.getElementById('zone-'+zone.replace(/\s/g,"-"));
  if (el) {
    el.classList.add('selected','flash');
    setTimeout(()=>el.classList.remove('flash'),700);
  }
}

function showQAModal(zone) {
  const qList = questionsPerZone[zone][currentLang] || questionsPerZone[zone].en;
  let html = "";
  qList.forEach((q, i) => {
    html += `
      <div class="mb-3">
        <span id="qtext${i}">${q}</span>
        <button onclick="speakText('qtext${i}')" class="ml-2 text-green-400" title="Speak">${translations[currentLang].speak}</button>
        <input type="text" id="ans${i}" class="mt-2 w-full p-2 rounded bg-gray-800 text-white" />
      </div>
    `;
  });
  html += `
    <button onclick="speakAllQuestions()" class="bg-blue-600 text-white px-3 py-1 rounded mb-2">${translations[currentLang].speak} All</button>
    <button onclick="submitQA('${zone}')" class="bg-green-500 px-4 py-2 mt-2 rounded">${translations[currentLang].submit}</button>
  `;
  document.getElementById("qa-title").innerText = (translations[currentLang][zone] || zone);
  document.getElementById("qa-questions").innerHTML = html;
  document.getElementById("qa-modal").classList.remove("hidden");
  document.getElementById("qa-modal").classList.add("block");
}

function closeQAModal() {
  document.getElementById("qa-modal").classList.add("hidden");
  document.getElementById("qa-modal").classList.remove("block");
}

function isEmergency(zone, ansArr) {
  if (zone === "Chest") {
    const a = ansArr.map(a=>a.toLowerCase());
    return (a[0].includes('yes')||a[0].includes('pain')) && (a[1].includes('yes')||a[1].includes('breath'));
  }
  return false;
}
function showEmergencyModal() {
  document.getElementById("emergency-modal").classList.remove("hidden");
}
function closeEmergencyModal() {
  document.getElementById("emergency-modal").classList.add("hidden");
}

// QA submission and recommendation logic
function submitQA(zone) {
  const qList = questionsPerZone[zone][currentLang] || questionsPerZone[zone].en;
  let ansArr = [];
  for (let i=0; i<qList.length; ++i) {
    const val = document.getElementById("ans"+i).value.trim();
    ansArr.push(val);
  }
  if (ansArr.some(v=>!v)) {
    alert(translations[currentLang].pleaseAnswer);
    return;
  }
  if (isEmergency(zone, ansArr)) {
    showEmergencyModal();
  }
  answers[zone] = ansArr;
  closeQAModal();

  let normalized = ansArr.map(a=>/yes|pain|weak|swelling|tingling|numb|‡§ö‡§ï‡•ç‡§ï‡§∞|‡§¶‡§∞‡•ç‡§¶|‡§ï‡§Æ‡§ú‡•ã‡§∞‡•Ä|‡§∏‡•Ç‡§ú‡§®|‡§ù‡§®‡§ù‡§®‡§æ‡§π‡§ü|‡§∏‡•Å‡§®‡•ç‡§®‡§™‡§®|‡≤®‡≥ã‡≤µ‡≥Å|‡≤¶‡≥Å‡≤∞‡≥ç‡≤¨‡≤≤‡≤§‡≥Ü|‡≤â‡≤¨‡≥ç‡≤¨‡≥Å|‡≤ö‡≥Å‡≤Æ‡≥Å‡≤ö‡≥Å‡≤Æ‡≥Å|‡≤∏‡≥Å‡≤®‡≥ç‡≤®‡≤æ‡≤ó‡≤ø‡≤∞‡≥Å‡≤µ‡≥Å‡≤¶‡≥á/i.test(a.trim().toLowerCase()));
  let rec = rules.find(r => r.part === zone && (r.emergency ? r.answers.every((_,i)=>normalized[i]) : normalized.some(v=>v)));
  if (!rec) rec = {
    specialist:"General Physician",
    tests:["Basic Checkup"],
    action:{
      en:"Monitor and consult if needed",
      hi:"‡§®‡§ø‡§ó‡§∞‡§æ‡§®‡•Ä ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§∏‡•á ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§Ç",
      kn:"‡≤™‡≤∞‡≥Ä‡≤ï‡≥ç‡≤∑‡≤ø‡≤∏‡≤ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤Ö‡≤ó‡≤§‡≥ç‡≤Ø‡≤µ‡≤ø‡≤¶‡≥ç‡≤¶‡≤∞‡≥Ü ‡≤µ‡≥à‡≤¶‡≥ç‡≤Ø‡≤∞‡≤®‡≥ç‡≤®‡≥Å ‡≤∏‡≤Ç‡≤™‡≤∞‡≥ç‡≤ï‡≤ø‡≤∏‡≤ø"
    },
    conditions: ["Unspecified"],
    why: "Symptoms are non-specific.",
    risk: "low"
  };
  riskFlag = rec.risk;
  sessionId = Date.now();
  saveSession({
    id: sessionId,
    gender: selectedGender,
    zone: selectedZone,
    answers: answers[selectedZone],
    lang: currentLang,
    timestamp: new Date().toISOString(),
    risk: riskFlag
  });
  let riskClass = rec.risk === "high" ? "risk-badge risk-high" : rec.risk === "med" ? "risk-badge risk-med" : "risk-badge risk-low";
  let riskLabel = rec.risk === "high" ? "üî¥ HIGH RISK" : rec.risk === "med" ? "üü° Moderate" : "üü¢ Low";
  let out = `
    <div class="mx-auto max-w-xl bg-gray-900/90 border border-green-700 rounded-xl p-6 mt-6 text-left">
      <h2 class="text-2xl font-extrabold mb-2 text-green-400">${translations[currentLang].summary}</h2>
      <div class="mb-2"><strong>${translations[currentLang].selectedBodyPart}:</strong> ${zone}</div>
      <div class="mb-2"><strong>${translations[currentLang].responses}:</strong>
        <ul class="list-disc pl-6">${qList.map((q,i)=>`<li>${q} <span class="text-green-300">‚Üí</span> <span>${ansArr[i]}</span></li>`).join('')}</ul>
      </div>
      <div class="mb-2"><strong>Possible Conditions:</strong> ${rec.conditions ? rec.conditions.join(', ') : "Unspecified"}</div>
      <div class="mb-2"><strong>Why this?</strong> ${rec.why || ""}</div>
      <div class="mb-2"><strong>Risk Level:</strong> <span class="${riskClass}">${riskLabel}</span></div>
      <div class="mb-2"><strong>${translations[currentLang].specialist}:</strong> ${rec.specialist}</div>
      <div class="mb-2"><strong>${translations[currentLang].tests}:</strong> ${rec.tests.join(', ')}</div>
      <div class="mb-2"><strong>${translations[currentLang].action}:</strong> ${rec.action[currentLang] || rec.action['en']}</div>
      <div class="mb-3 bg-green-800/80 px-3 py-2 rounded">${translations[currentLang].wellnessTip}: ${(wellnessTips[currentLang]||wellnessTips['en'])[Math.floor(Math.random()*wellnessTips['en'].length)]}</div>
      <div class="flex flex-wrap gap-2 mt-2">
        <button onclick="showDoctorDashboard()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">${translations[currentLang].doctorDashboard}</button>
        <button onclick="downloadSessionPDF()" class="bg-purple-600 text-white px-4 py-2 rounded">${translations[currentLang].downloadPDF}</button>
        <button onclick="showQRModal()" class="bg-yellow-500 text-black px-4 py-2 rounded">${translations[currentLang].shareQR}</button>
        <button onclick="window.location.reload()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">${translations[currentLang].startOver}</button>
      </div>
    </div>
  `;
  document.getElementById("output").innerHTML = out;
}

const rules = [
  { part: "Head", answers: [true], specialist: "Neurologist", tests: ["MRI (if severe)"], action: {en:"Rest and monitor, consult if persists",hi:"‡§Ü‡§∞‡§æ‡§Æ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§Ø‡§¶‡§ø ‡§≤‡§ï‡•ç‡§∑‡§£ ‡§¨‡§®‡•á ‡§∞‡§π‡•á‡§Ç ‡§§‡•ã ‡§™‡§∞‡§æ‡§Æ‡§∞‡•ç‡§∂ ‡§ï‡§∞‡•á‡§Ç",kn:"‡≤µ‡≤ø‡≤∂‡≥ç‡≤∞‡≤æ‡≤Ç‡≤§‡≤ø ‡≤Æ‡≤æ‡≤°‡≤ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤Æ‡≥Å‡≤Ç‡≤¶‡≥Å‡≤µ‡≤∞‡≤ø‡≤¶‡≤∞‡≥Ü ‡≤µ‡≥à‡≤¶‡≥ç‡≤Ø‡≤∞‡≤®‡≥ç‡≤®‡≥Å ‡≤∏‡≤Ç‡≤™‡≤∞‡≥ç‡≤ï‡≤ø‡≤∏‡≤ø"}, conditions: ["Migraine", "Tension headache"], why: "Your symptoms may be related to migraine or tension headache, as you reported headache with dizziness and/or nausea.", risk: "med" },
  { part: "Chest", answers: [true,true], specialist: "Cardiologist", tests: ["ECG"], action: {en:"Visit clinic or ER immediately",hi:"‡§§‡•Å‡§∞‡§Ç‡§§ ‡§ï‡•ç‡§≤‡§ø‡§®‡§ø‡§ï ‡§Ø‡§æ ‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤‡•Ä‡§® ‡§µ‡§ø‡§≠‡§æ‡§ó ‡§ú‡§æ‡§è‡§Å",kn:"‡≤§‡≤ï‡≥ç‡≤∑‡≤£ ‡≤ï‡≥ç‡≤≤‡≤ø‡≤®‡≤ø‡≤ï‡≥ç ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤§‡≥Å‡≤∞‡≥ç‡≤§‡≥Å ‡≤∏‡≥á‡≤µ‡≥Ü‡≤ó‡≥Ü ‡≤π‡≥ã‡≤ó‡≤ø"}, conditions: ["Heart Attack", "Angina"], why: "Chest pain with shortness of breath is a medical emergency.", risk: "high", emergency: true },
  { part: "Chest", answers: [true], specialist: "Cardiologist", tests: ["ECG"], action: {en:"Visit clinic soon",hi:"‡§ú‡§≤‡•ç‡§¶‡•Ä ‡§ï‡•ç‡§≤‡§ø‡§®‡§ø‡§ï ‡§ú‡§æ‡§è‡§Å",kn:"‡≤§‡≤æ‡≥¶‡≤§‡≥ç‡≤∞‡≤ø‡≤ï‡≤µ‡≤æ‡≤ó‡≤ø ‡≤ï‡≥ç‡≤≤‡≤ø‡≤®‡≤ø‡≤ï‡≥ç‚Äå‡≤ó‡≥Ü ‡≤π‡≥ã‡≤ó‡≤ø"}, conditions: ["Angina"], why: "Chest pain can be related to heart conditions.", risk: "med" },
  { part: "Chest", answers: [false, true], specialist: "Pulmonologist", tests: ["Chest X-ray"], action: {en:"Visit doctor soon",hi:"‡§ú‡§≤‡•ç‡§¶‡•Ä ‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§∏‡•á ‡§Æ‡§ø‡§≤‡•á‡§Ç",kn:"‡≤¨‡≥á‡≤ó ‡≤µ‡≥à‡≤¶‡≥ç‡≤Ø‡≤∞‡≤®‡≥ç‡≤®‡≥Å ‡≤∏‡≤Ç‡≤™‡≤∞‡≥ç‡≤ï‡≤ø‡≤∏‡≤ø"}, conditions: ["Asthma", "Bronchitis"], why: "Shortness of breath may indicate a respiratory condition.", risk: "med" },
  { part: "Abdomen", answers: [true], specialist: "Gastroenterologist", tests: ["Ultrasound"], action: {en:"Monitor diet, consult if severe",hi:"‡§Ü‡§π‡§æ‡§∞ ‡§™‡§∞ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§Ç, ‡§ó‡§Ç‡§≠‡•Ä‡§∞ ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§™‡§∞‡§æ‡§Æ‡§∞‡•ç‡§∂ ‡§ï‡§∞‡•á‡§Ç",kn:"‡≤Ü‡≤π‡≤æ‡≤∞‡≤¶ ‡≤Æ‡≥á‡≤≤‡≥Ü ‡≤ó‡≤Æ‡≤® ‡≤®‡≥Ä‡≤°‡≤ø, ‡≤§‡≥Ä‡≤µ‡≥ç‡≤∞‡≤µ‡≤æ‡≤¶‡≤∞‡≥Ü ‡≤µ‡≥à‡≤¶‡≥ç‡≤Ø‡≤∞‡≤®‡≥ç‡≤®‡≥Å ‡≤∏‡≤Ç‡≤™‡≤∞‡≥ç‡≤ï‡≤ø‡≤∏‡≤ø"}, conditions: ["Indigestion", "Gastritis"], why: "Stomach pain can be due to gastritis or indigestion.", risk: "med" },
  { part: "Left Leg", answers: [true], specialist: "Orthopedic", tests: ["X-ray"], action: {en:"Rest and observe, visit doctor if swelling",hi:"‡§Ü‡§∞‡§æ‡§Æ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§¶‡•á‡§ñ‡•á‡§Ç, ‡§∏‡•Ç‡§ú‡§® ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§∏‡•á ‡§Æ‡§ø‡§≤‡•á‡§Ç",kn:"‡≤µ‡≤ø‡≤∂‡≥ç‡≤∞‡≤æ‡≤Ç‡≤§‡≤ø ‡≤Æ‡≤æ‡≤°‡≤ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤ó‡≤Æ‡≤®‡≤ø‡≤∏‡≤ø, ‡≤â‡≤¨‡≥ç‡≤¨‡≥Å ‡≤á‡≤¶‡≥ç‡≤¶‡≤∞‡≥Ü ‡≤µ‡≥à‡≤¶‡≥ç‡≤Ø‡≤∞‡≤®‡≥ç‡≤®‡≥Å ‡≤∏‡≤Ç‡≤™‡≤∞‡≥ç‡≤ï‡≤ø‡≤∏‡≤ø"}, conditions: ["Muscle Strain", "Sprain"], why: "Pain/swelling may be due to injury or overuse.", risk: "low" },
  { part: "Right Leg", answers: [true], specialist: "Orthopedic", tests: ["X-ray"], action: {en:"Rest and observe, visit doctor if swelling",hi:"‡§Ü‡§∞‡§æ‡§Æ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§¶‡•á‡§ñ‡•á‡§Ç, ‡§∏‡•Ç‡§ú‡§® ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§∏‡•á ‡§Æ‡§ø‡§≤‡•á‡§Ç",kn:"‡≤µ‡≤ø‡≤∂‡≥ç‡≤∞‡≤æ‡≤Ç‡≤§‡≤ø ‡≤Æ‡≤æ‡≤°‡≤ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤ó‡≤Æ‡≤®‡≤ø‡≤∏‡≤ø, ‡≤â‡≤¨‡≥ç‡≤¨‡≥Å ‡≤á‡≤¶‡≥ç‡≤¶‡≤∞‡≥Ü ‡≤µ‡≥à‡≤¶‡≥ç‡≤Ø‡≤∞‡≤®‡≥ç‡≤®‡≥Å ‡≤∏‡≤Ç‡≤™‡≤∞‡≥ç‡≤ï‡≤ø‡≤∏‡≤ø"}, conditions: ["Muscle Strain", "Sprain"], why: "Pain/swelling may be due to injury or overuse.", risk: "low" },
  { part: "Left Arm", answers: [true], specialist: "Orthopedic/Neurologist", tests: ["Nerve conduction study if persistent"], action: {en:"Rest, avoid strain, consult if persists",hi:"‡§µ‡§ø‡§∂‡•ç‡§∞‡§æ‡§Æ ‡§ï‡§∞‡•á‡§Ç, ‡§¶‡§¨‡§æ‡§µ ‡§∏‡•á ‡§¨‡§ö‡•á‡§Ç, ‡§¨‡§®‡•á ‡§∞‡§π‡§®‡•á ‡§™‡§∞ ‡§™‡§∞‡§æ‡§Æ‡§∞‡•ç‡§∂ ‡§ï‡§∞‡•á‡§Ç",kn:"‡≤µ‡≤ø‡≤∂‡≥ç‡≤∞‡≤æ‡≤Ç‡≤§‡≤ø ‡≤Æ‡≤æ‡≤°‡≤ø, ‡≤í‡≤§‡≥ç‡≤§‡≤° ‡≤§‡≤™‡≥ç‡≤™‡≤ø‡≤∏‡≤ø, ‡≤Æ‡≥Å‡≤Ç‡≤¶‡≥Å‡≤µ‡≤∞‡≤ø‡≤¶‡≤∞‡≥Ü ‡≤µ‡≥à‡≤¶‡≥ç‡≤Ø‡≤∞‡≤®‡≥ç‡≤®‡≥Å ‡≤∏‡≤Ç‡≤™‡≤∞‡≥ç‡≤ï‡≤ø‡≤∏‡≤ø"}, conditions: ["Tendinitis", "Nerve compression"], why: "Pain or numbness in the arm may be related to nerve or muscle problems.", risk: "low" },
  { part: "Right Arm", answers: [true], specialist: "Orthopedic/Neurologist", tests: ["Nerve conduction study if persistent"], action: {en:"Rest, avoid strain, consult if persists",hi:"‡§µ‡§ø‡§∂‡•ç‡§∞‡§æ‡§Æ ‡§ï‡§∞‡•á‡§Ç, ‡§¶‡§¨‡§æ‡§µ ‡§∏‡•á ‡§¨‡§ö‡•á‡§Ç, ‡§¨‡§®‡•á ‡§∞‡§π‡§®‡•á ‡§™‡§∞ ‡§™‡§∞‡§æ‡§Æ‡§∞‡•ç‡§∂ ‡§ï‡§∞‡•á‡§Ç",kn:"‡≤µ‡≤ø‡≤∂‡≥ç‡≤∞‡≤æ‡≤Ç‡≤§‡≤ø ‡≤Æ‡≤æ‡≤°‡≤ø, ‡≤í‡≤§‡≥ç‡≤§‡≤° ‡≤§‡≤™‡≥ç‡≤™‡≤ø‡≤∏‡≤ø, ‡≤Æ‡≥Å‡≤Ç‡≤¶‡≥Å‡≤µ‡≤∞‡≤ø‡≤¶‡≤∞‡≥Ü ‡≤µ‡≥à‡≤¶‡≥ç‡≤Ø‡≤∞‡≤®‡≥ç‡≤®‡≥Å ‡≤∏‡≤Ç‡≤™‡≤∞‡≥ç‡≤ï‡≤ø‡≤∏‡≤ø"}, conditions: ["Tendinitis", "Nerve compression"], why: "Pain or numbness in the arm may be related to nerve or muscle problems.", risk: "low" }
];

const wellnessTips = {
  en: [
    "Stay hydrated and rest as needed.",
    "Monitor symptoms and seek help if worsening.",
    "Eat healthy and avoid stress."
  ],
  hi: [
    "‡§π‡§æ‡§á‡§°‡•ç‡§∞‡•á‡§ü‡•á‡§° ‡§∞‡§π‡•á‡§Ç ‡§î‡§∞ ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§Ü‡§∞‡§æ‡§Æ ‡§ï‡§∞‡•á‡§Ç‡•§",
    "‡§≤‡§ï‡•ç‡§∑‡§£ ‡§¨‡§ø‡§ó‡§°‡§º‡§®‡•á ‡§™‡§∞ ‡§Æ‡§¶‡§¶ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç‡•§",
    "‡§∏‡•ç‡§µ‡§∏‡•ç‡§• ‡§ñ‡§æ‡§è‡§Ç ‡§î‡§∞ ‡§§‡§®‡§æ‡§µ ‡§∏‡•á ‡§¨‡§ö‡•á‡§Ç‡•§"
  ],
  kn: [
    "‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤¶‡≥á‡≤π‡≤ï‡≥ç‡≤ï‡≥Ü ‡≤®‡≥Ä‡≤∞‡≥Å ‡≤®‡≥Ä‡≤°‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤∞‡≤ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤Ö‡≤ó‡≤§‡≥ç‡≤Ø‡≤µ‡≤ø‡≤¶‡≥ç‡≤¶‡≤∞‡≥Ü ‡≤µ‡≤ø‡≤∂‡≥ç‡≤∞‡≤æ‡≤Ç‡≤§‡≤ø ‡≤Æ‡≤æ‡≤°‡≤ø.",
    "‡≤≤‡≤ï‡≥ç‡≤∑‡≤£‡≤ó‡≤≥‡≥Å ‡≤π‡≤¶‡≤ó‡≥Ü‡≤ü‡≥ç‡≤ü‡≤∞‡≥Ü ‡≤∏‡≤π‡≤æ‡≤Ø‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤™‡≤°‡≥Ü‡≤Ø‡≤ø‡≤∞‡≤ø.",
    "‡≤Ü‡≤∞‡≥ã‡≤ó‡≥ç‡≤Ø‡≤ï‡≤∞‡≤µ‡≤æ‡≤ó‡≤ø ‡≤§‡≤ø‡≤®‡≥ç‡≤®‡≤ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤í‡≤§‡≥ç‡≤§‡≤° ‡≤§‡≤™‡≥ç‡≤™‡≤ø‡≤∏‡≤ø."
  ]
};

function saveSession(session) {
  let allSessions = JSON.parse(localStorage.getItem('symptomSessions') || '[]');
  allSessions.push(session);
  localStorage.setItem('symptomSessions', JSON.stringify(allSessions));
}

// Doctor Dashboard
function showDoctorDashboard() {
  const sessions = JSON.parse(localStorage.getItem('symptomSessions') || '[]');
  let html = "";
  if (sessions.length === 0) html += "<p>No sessions yet.</p>";
  else {
    html += `<table class="w-full text-left text-xs md:text-sm"><thead><tr class="text-green-300 bg-green-900/30">
      <th>Time</th>
      <th>Body Part</th>
      <th>Gender</th>
      <th>Risk</th>
      <th>Actions</th>
    </tr></thead><tbody>`;
    sessions.slice().reverse().forEach(s => {
      let riskClass = s.risk === "high" ? "risk-badge risk-high" : s.risk === "med" ? "risk-badge risk-med" : "risk-badge risk-low";
      let riskLabel = s.risk === "high" ? "üî¥ HIGH" : s.risk === "med" ? "üü° Moderate" : "üü¢ Low";
      html += `<tr>
        <td>${new Date(s.timestamp).toLocaleString()}</td>
        <td>${s.zone}</td>
        <td>${s.gender}</td>
        <td><span class="${riskClass}">${riskLabel}</span></td>
        <td>
          <button onclick="showSessionDetail(${s.id})" class="bg-blue-500 px-2 rounded text-white mr-1">View</button>
          <button onclick="deleteSession(${s.id})" class="bg-red-500 px-2 rounded text-white">Delete</button>
          <button onclick="showQRModal(${s.id})" class="bg-yellow-400 px-2 rounded text-black ml-1">QR</button>
        </td>
      </tr>`;
    });
    html += `</tbody></table>`;
  }
  document.getElementById("dashboard-list").innerHTML = html;
  document.getElementById("doctor-dashboard").classList.remove("hidden");
}
function closeDoctorDashboard() {
  document.getElementById("doctor-dashboard").classList.add("hidden");
}

// Doctor session detail
function showSessionDetail(id) {
  const sessions = JSON.parse(localStorage.getItem('symptomSessions') || '[]');
  const s = sessions.find(x => x.id === id);
  if (!s) return;
  let qList = questionsPerZone[s.zone] ? (questionsPerZone[s.zone][s.lang] || questionsPerZone[s.zone].en) : [];
  let riskClass = s.risk === "high" ? "risk-badge risk-high" : s.risk === "med" ? "risk-badge risk-med" : "risk-badge risk-low";
  let riskLabel = s.risk === "high" ? "üî¥ HIGH RISK" : s.risk === "med" ? "üü° Moderate" : "üü¢ Low";
  let html = `<div class="bg-gray-800 p-4 rounded-lg max-w-xl mx-auto">
    <div class="mb-1"><b>Time:</b> ${new Date(s.timestamp).toLocaleString()}</div>
    <div class="mb-1"><b>Gender:</b> ${s.gender}</div>
    <div class="mb-1"><b>Body Part:</b> ${s.zone}</div>
    <div class="mb-1"><b>Risk:</b> <span class="${riskClass}">${riskLabel}</span></div>
    <div class="mb-1"><b>Answers:</b> <ul class="list-disc ml-6">${(s.answers||[]).map((a,i)=>`<li>${qList[i]||''}: ${a}</li>`).join('')}</ul></div>
  </div>`;
  document.getElementById("session-detail-content").innerHTML = html;
  document.getElementById("doctor-session-detail").classList.remove("hidden");
}
function closeSessionDetail() {
  document.getElementById("doctor-session-detail").classList.add("hidden");
}

function deleteSession(id) {
  if (!confirm("Are you sure you want to delete this session?")) return;
  let sessions = JSON.parse(localStorage.getItem('symptomSessions') || '[]');
  sessions = sessions.filter(s => s.id !== id);
  localStorage.setItem('symptomSessions', JSON.stringify(sessions));
  showDoctorDashboard();
}
function deleteAllSessions() {
  if (!confirm("Are you sure you want to delete ALL sessions?")) return;
  localStorage.removeItem('symptomSessions');
  showDoctorDashboard();
}

// Export All as CSV/JSON
function exportAllCSV() {
  const sessions = JSON.parse(localStorage.getItem('symptomSessions') || '[]');
  if (sessions.length === 0) { alert('No sessions to export.'); return; }
  let rows = [["Time","Body Part","Gender","Risk","Answers"]];
  sessions.forEach(s=>{
    rows.push([
      new Date(s.timestamp).toLocaleString(),
      s.zone,
      s.gender,
      s.risk,
      (s.answers||[]).join(" | ")
    ]);
  });
  let csv = rows.map(r=>r.map(a=>`"${a.replace(/"/g,'""')}"`).join(',')).join('\n');
  let blob = new Blob([csv],{type:'text/csv'});
  let url = URL.createObjectURL(blob);
  let a = document.createElement('a');
  a.href = url;
  a.download = "all_sessions.csv";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
}
function exportAllJSON() {
  const sessions = JSON.parse(localStorage.getItem('symptomSessions') || '[]');
  if (sessions.length === 0) { alert('No sessions to export.'); return; }
  let blob = new Blob([JSON.stringify(sessions,null,2)],{type:'application/json'});
  let url = URL.createObjectURL(blob);
  let a = document.createElement('a');
  a.href = url;
  a.download = "all_sessions.json";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
}

// QR code sharing
function showQRModal(id=null) {
  let session;
  if (id) {
    let sessions = JSON.parse(localStorage.getItem('symptomSessions') || '[]');
    session = sessions.find(s=>s.id===id);
  } else {
    let sessions = JSON.parse(localStorage.getItem('symptomSessions') || '[]');
    session = sessions[sessions.length-1];
  }
  const txt = `BodyPart: ${session.zone}, Gender: ${session.gender}, Risk: ${session.risk}, Answers: ${(session.answers||[]).join(" | ")}`;
  let qr = new QRious({
    value: txt,
    size: 200,
    background: '#fff',
    foreground: '#222'
  });
  document.getElementById("qr-code").innerHTML = "";
  document.getElementById("qr-code").appendChild(qr.image);
  document.getElementById("qr-modal").classList.remove("hidden");
}
function closeQRModal() {
  document.getElementById("qr-modal").classList.add("hidden");
}

// PDF Download Function
function downloadSessionPDF() {
  if (!selectedZone || !answers[selectedZone] || !selectedGender) {
    alert("Please complete a session to download as PDF.");
    return;
  }
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  const zone = selectedZone;
  const gender = selectedGender;
  const qList = questionsPerZone[zone][currentLang] || questionsPerZone[zone].en;
  const ansArr = answers[zone];
  const dateStr = new Date(sessionId).toLocaleString();
  let normalized = ansArr.map(a=>/yes|pain|weak|swelling|tingling|numb|‡§ö‡§ï‡•ç‡§ï‡§∞|‡§¶‡§∞‡•ç‡§¶|‡§ï‡§Æ‡§ú‡•ã‡§∞‡•Ä|‡§∏‡•Ç‡§ú‡§®|‡§ù‡§®‡§ù‡§®‡§æ‡§π‡§ü|‡§∏‡•Å‡§®‡•ç‡§®‡§™‡§®|‡≤®‡≥ã‡≤µ‡≥Å|‡≤¶‡≥Å‡≤∞‡≥ç‡≤¨‡≤≤‡≤§‡≥Ü|‡≤â‡≤¨‡≥ç‡≤¨‡≥Å|‡≤ö‡≥Å‡≤Æ‡≥Å‡≤ö‡≥Å‡≤Æ‡≥Å|‡≤∏‡≥Å‡≤®‡≥ç‡≤®‡≤æ‡≤ó‡≤ø‡≤∞‡≥Å‡≤µ‡≥Å‡≤¶‡≥á/i.test(a.trim().toLowerCase()));
  let rec = rules.find(r => r.part === zone && (r.emergency ? r.answers.every((_,i)=>normalized[i]) : normalized.some(v=>v)));
  if (!rec) rec = {
    specialist:"General Physician",
    tests:["Basic Checkup"],
    action:{
      en:"Monitor and consult if needed",
      hi:"‡§®‡§ø‡§ó‡§∞‡§æ‡§®‡•Ä ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§∏‡•á ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§Ç",
      kn:"‡≤™‡≤∞‡≥Ä‡≤ï‡≥ç‡≤∑‡≤ø‡≤∏‡≤ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤Ö‡≤ó‡≤§‡≥ç‡≤Ø‡≤µ‡≤ø‡≤¶‡≥ç‡≤¶‡≤∞‡≥Ü ‡≤µ‡≥à‡≤¶‡≥ç‡≤Ø‡≤∞‡≤®‡≥ç‡≤®‡≥Å ‡≤∏‡≤Ç‡≤™‡≤∞‡≥ç‡≤ï‡≤ø‡≤∏‡≤ø"
    },
    conditions: ["Unspecified"],
    why: "Symptoms are non-specific.",
    risk: "low"
  };
  let riskLabel = rec.risk === "high" ? "HIGH RISK" : rec.risk === "med" ? "Moderate" : "Low";

  doc.setFontSize(16);
  doc.text("Symptom Navigator - Session Summary", 12, 15);
  doc.setFontSize(12);
  doc.text(`Date: ${dateStr}`, 12, 22);
  doc.text(`Gender: ${gender}`, 12, 28);
  doc.text(`Body Part: ${zone}`, 12, 34);

  let y = 42;
  doc.setFontSize(12);
  doc.text("Questions & Answers:", 12, y);

  y += 7;
  for (let i = 0; i < qList.length; i++) {
    const q = qList[i];
    const a = ansArr[i] || "";
    doc.setFont("helvetica", "bold");
    doc.text(`Q${i+1}: ${q}`, 12, y);
    y += 6;
    doc.setFont("helvetica", "normal");
    doc.text(`A${i+1}: ${a}`, 16, y);
    y += 7;
    if (y > 270) {
      doc.addPage();
      y = 15;
    }
  }
  y += 3;
  doc.setFont("helvetica", "bold");
  doc.text(`Possible Conditions:`, 12, y); doc.setFont("helvetica", "normal"); doc.text(`${rec.conditions ? rec.conditions.join(', ') : "Unspecified"}`, 52, y);
  y += 7;
  doc.setFont("helvetica", "bold");
  doc.text(`Why this:`, 12, y); doc.setFont("helvetica", "normal"); doc.text(`${rec.why || ""}`, 34, y);
  y += 7;
  doc.setFont("helvetica", "bold");
  doc.text(`Risk Level:`, 12, y); doc.setFont("helvetica", "normal"); doc.text(`${riskLabel}`, 36, y);
  y += 7;
  doc.setFont("helvetica", "bold");
  doc.text(`Specialist:`, 12, y); doc.setFont("helvetica", "normal"); doc.text(`${rec.specialist}`, 38, y);
  y += 7;
  doc.setFont("helvetica", "bold");
  doc.text(`Tests:`, 12, y); doc.setFont("helvetica", "normal"); doc.text(`${rec.tests.join(', ')}`, 28, y);
  y += 7;
  doc.setFont("helvetica", "bold");
  doc.text(`Advice:`, 12, y); doc.setFont("helvetica", "normal"); doc.text(`${rec.action[currentLang] || rec.action['en']}`, 28, y);
  y += 10;
  doc.setFont("helvetica", "bold");
  doc.text(`Wellness Tip:`, 12, y);
  doc.setFont("helvetica", "normal");
  doc.text(`${(wellnessTips[currentLang]||wellnessTips['en'])[Math.floor(Math.random()*wellnessTips['en'].length)]}`, 40, y);

  doc.save("session-summary.pdf");
}
</script>
</body>
</html>