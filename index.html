<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Smart Symptom Navigator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .click-zone {
      position: absolute;
      cursor: pointer;
      background: rgba(0, 255, 0, 0.10);
      border-radius: 8px;
      transition: box-shadow 0.2s, background 0.2s;
    }
    .click-zone:hover { background: rgba(34,197,94,0.22); box-shadow:0 0 8px 2px #38b2ac44;}
    .male-bg { background: radial-gradient(circle at 60% 20%, #e6f6ff 50px, #b6e0fe 300px, #0e2f44 100%);}
    .female-bg { background: radial-gradient(circle at 40% 70%, #ffe6fa 60px, #fbb6ce 300px, #3b133e 100%);}
    .neutral-bg { background: linear-gradient(135deg, #232526 0%, #414345 100%);}
    select, option { color-scheme: dark;}
    .mic-btn {background:#222;border-radius:50%;padding:4px 9px;display:inline-block;}
    .mic-btn.active {background:#059669;}
    .modal-bg {background:rgba(0,0,0,0.60);}
    .modal {z-index:90;}
    .dashboard-modal {z-index:100;}
  </style>
</head>
<body class="neutral-bg min-h-screen text-gray-100 font-sans transition-colors duration-700">

<!-- Language Toggle -->
<div class="text-center my-3">
  <button onclick="setLanguage('en')" class="bg-blue-400 text-white px-3 py-1 rounded mx-1">English</button>
  <button onclick="setLanguage('hi')" class="bg-blue-400 text-white px-3 py-1 rounded mx-1">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</button>
  <button onclick="setLanguage('kn')" class="bg-blue-400 text-white px-3 py-1 rounded mx-1">‡≤ï‡≤®‡≥ç‡≤®‡≤°</button>
</div>

<header class="bg-white/10 dark:bg-white/10 backdrop-blur-md text-center py-6 shadow-md rounded-xl mx-auto mb-4 max-w-2xl">
  <h1 class="text-4xl font-extrabold text-green-400 dark:text-green-400 drop-shadow-md tracking-wide">
    <span data-i18n="appTitle">Symptom Navigator</span> ü©∫
  </h1>
  <p class="mt-2 italic text-blue-400 text-base" data-i18n="subtitle">Your smart step towards understanding your health</p>
</header>

<!-- Gender Selection -->
<div id="gender-selection" class="text-center py-5">
  <h2 class="text-lg font-semibold mb-4" data-i18n="selectGender">Select Gender</h2>
  <button onclick="selectGender('male')" class="bg-green-500 hover:bg-green-600 transition-colors duration-200 text-white px-6 py-2 rounded-full mx-2 shadow-md">üë® <span data-i18n="male">Male</span></button>
  <button onclick="selectGender('female')" class="bg-pink-500 hover:bg-pink-600 transition-colors duration-200 text-white px-6 py-2 rounded-full mx-2 shadow-md">üë© <span data-i18n="female">Female</span></button>
</div>

<!-- Body Section -->
<div id="body-section" class="relative flex justify-center hidden mt-4">
  <img id="body-image" src="" alt="Body Model" class="max-w-xs rounded-2xl shadow-lg border-2 border-green-200 dark:border-green-700" />
  <!-- click-zones -->
  <div class="click-zone" style="top: 13%; left: 44%; width: 12%; height: 10%;" onclick="zoneClicked('Head', event)"></div>
  <div class="click-zone" style="top: 27%; left: 42%; width: 16%; height: 13%;" onclick="zoneClicked('Chest', event)"></div>
  <div class="click-zone" style="top: 41%; left: 44%; width: 12%; height: 13%;" onclick="zoneClicked('Abdomen', event)"></div>
  <div class="click-zone" style="top: 62%; left: 30%; width: 12%; height: 24%;" onclick="zoneClicked('Left Leg', event)"></div>
  <div class="click-zone" style="top: 62%; left: 58%; width: 12%; height: 24%;" onclick="zoneClicked('Right Leg', event)"></div>
  <div id="options-popover" class="absolute z-40 hidden"></div>
</div>

<!-- Questionnaire -->
<div id="qa-modal" class="hidden fixed inset-0 modal-bg flex items-center justify-center z-50 modal">
  <div class="bg-gray-900/95 rounded-xl shadow-xl max-w-md w-full p-6 border border-green-600">
    <h2 class="text-lg mb-2 font-bold text-green-400" id="qa-title"></h2>
    <div id="qa-questions" class="mb-2"></div>
    <button onclick="closeQAModal()" class="mt-3 bg-red-500 hover:bg-red-600 px-4 py-2 rounded text-white">Close</button>
  </div>
</div>

<!-- Output & Doctor View -->
<div id="output" class="text-center mt-6 text-lg font-medium"></div>
<div class="hidden fixed inset-0 modal-bg flex items-center justify-center dashboard-modal" id="sessions-modal" >
  <div class="bg-gray-900/95 p-5 rounded-lg w-full max-w-2xl shadow-2xl border border-green-700">
    <h2 class="text-2xl font-bold mb-4 text-green-400" id="sessions-title">All Patient Sessions</h2>
    <div id="sessions-list"></div>
    <button onclick="closeAllSessions()" class="mt-4 bg-red-500 hover:bg-red-700 text-white px-4 py-2 rounded">Close</button>
  </div>
</div>
<div id="doctor-summary" class="hidden fixed inset-0 modal-bg flex items-center justify-center z-50 modal">
  <div class="bg-gray-900/95 dark:bg-gray-800/95 p-6 rounded-lg w-full max-w-xl shadow-2xl border border-green-700">
    <h2 class="text-2xl font-bold mb-4" data-i18n="doctorSummary">ü©∫ Professional Doctor View</h2>
    <div id="summary-content" class="text-left text-sm space-y-2"></div>
    <button onclick="closeDoctorSummary()" class="mt-4 bg-red-500 hover:bg-red-700 transition-all duration-200 text-white px-4 py-2 rounded" data-i18n="close">Close</button>
  </div>
</div>

<script>
let currentLang = 'en';
let selectedGender = null;
let selectedZone = "";
let answers = {};
let sessionId = null;

const translations = {
  en: {
    appTitle: "Symptom Navigator",
    subtitle: "Your smart step towards understanding your health",
    selectGender: "Select Gender",
    male: "Male",
    female: "Female",
    start: "Start",
    doctorSummary: "Doctor View: Patient Report",
    close: "Close",
    submit: "Submit",
    next: "Next",
    speak: "üîä Read",
    mic: "üé§ Speak",
    summary: "Summary",
    specialist: "Specialist",
    tests: "Recommended Tests",
    action: "Triage Advice",
    followup: "Follow-up Q&A",
    selectedBodyPart: "Body Part",
    answer: "Answer",
    responses: "Responses",
    startOver: "Start Over",
    viewDoctorSummary: "View Doctor Summary",
    timestamp: "Time",
    wellnessTip: "Wellness Tip",
    pleaseAnswer: "Please answer all questions.",
    viewAllSessions: "View All Sessions"
  },
  hi: {
    appTitle: "‡§≤‡§ï‡•ç‡§∑‡§£ ‡§®‡•á‡§µ‡§ø‡§ó‡•á‡§ü‡§∞",
    subtitle: "‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§∏‡§Æ‡§ù‡§®‡•á ‡§ï‡§æ ‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§§‡§∞‡•Ä‡§ï‡§æ",
    selectGender: "‡§≤‡§ø‡§Ç‡§ó ‡§ö‡•Å‡§®‡•á‡§Ç",
    male: "‡§™‡•Å‡§∞‡•Å‡§∑",
    female: "‡§Æ‡§π‡§ø‡§≤‡§æ",
    start: "‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç",
    doctorSummary: "‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§¶‡•É‡§∂‡•ç‡§Ø: ‡§∞‡•ã‡§ó‡•Ä ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü",
    close: "‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç",
    submit: "‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡•á‡§Ç",
    next: "‡§Ü‡§ó‡•á",
    speak: "üîä ‡§™‡§¢‡§º‡•á‡§Ç",
    mic: "üé§ ‡§¨‡•ã‡§≤‡•á‡§Ç",
    summary: "‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂",
    specialist: "‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û",
    tests: "‡§∏‡§ø‡§´‡§æ‡§∞‡§ø‡§∂ ‡§ï‡•Ä ‡§ó‡§à ‡§ú‡§æ‡§Ç‡§ö",
    action: "‡§§‡•ç‡§∞‡•à‡§ú ‡§∏‡§≤‡§æ‡§π",
    followup: "‡§Ö‡§®‡•Å‡§µ‡§∞‡•ç‡§§‡•Ä Q&A",
    selectedBodyPart: "‡§∂‡§∞‡•Ä‡§∞ ‡§ï‡§æ ‡§≠‡§æ‡§ó",
    answer: "‡§â‡§§‡•ç‡§§‡§∞",
    responses: "‡§∏‡§≠‡•Ä ‡§â‡§§‡•ç‡§§‡§∞",
    startOver: "‡§´‡§ø‡§∞ ‡§∏‡•á ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç",
    viewDoctorSummary: "‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂ ‡§¶‡•á‡§ñ‡•á‡§Ç",
    timestamp: "‡§∏‡§Æ‡§Ø",
    wellnessTip: "‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§∏‡•Å‡§ù‡§æ‡§µ",
    pleaseAnswer: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§∏‡§µ‡§æ‡§≤‡•ã‡§Ç ‡§ï‡•á ‡§ú‡§µ‡§æ‡§¨ ‡§¶‡•á‡§Ç‡•§",
    viewAllSessions: "‡§∏‡§≠‡•Ä ‡§∏‡§§‡•ç‡§∞ ‡§¶‡•á‡§ñ‡•á‡§Ç"
  },
  kn: {
    appTitle: "‡≤≤‡≤ï‡≥ç‡≤∑‡≤£ ‡≤®‡≥ç‡≤Ø‡≤æ‡≤µ‡≤ø‡≤ó‡≥á‡≤ü‡≤∞‡≥ç",
    subtitle: "‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤Ü‡≤∞‡≥ã‡≤ó‡≥ç‡≤Ø‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤Ö‡≤∞‡≥ç‡≤•‡≤Æ‡≤æ‡≤°‡≤ø‡≤ï‡≥ä‡≤≥‡≥ç‡≤≥‡≥Å‡≤µ ‡≤∏‡≥ç‡≤Æ‡≤æ‡≤∞‡≥ç‡≤ü‡≥ç ‡≤π‡≤æ‡≤¶‡≤ø",
    selectGender: "‡≤≤‡≤ø‡≤Ç‡≤ó ‡≤Ü‡≤Ø‡≥ç‡≤ï‡≥Ü‡≤Æ‡≤æ‡≤°‡≤ø",
    male: "‡≤™‡≥Å‡≤∞‡≥Å‡≤∑",
    female: "‡≤Æ‡≤π‡≤ø‡≤≥‡≥Ü",
    start: "‡≤™‡≥ç‡≤∞‡≤æ‡≤∞‡≤Ç‡≤≠‡≤ø‡≤∏‡≤ø",
    doctorSummary: "‡≤°‡≤æ‡≤ï‡≥ç‡≤ü‡≤∞‡≥ç ‡≤µ‡≥Ä‡≤ï‡≥ç‡≤∑‡≤£‡≥Ü: ‡≤∞‡≥ã‡≤ó‡≤ø ‡≤µ‡≤∞‡≤¶‡≤ø",
    close: "‡≤Æ‡≥Å‡≤ö‡≥ç‡≤ö‡≤ø",
    submit: "‡≤∏‡≤≤‡≥ç‡≤≤‡≤ø‡≤∏‡≤ø",
    next: "‡≤Æ‡≥Å‡≤Ç‡≤¶‡≥Ü",
    speak: "üîä ‡≤ì‡≤¶‡≤ø",
    mic: "üé§ ‡≤Æ‡≤æ‡≤§‡≤®‡≤æ‡≤°‡≤ø",
    summary: "‡≤∏‡≤æ‡≤∞‡≤æ‡≤Ç‡≤∂",
    specialist: "‡≤§‡≤ú‡≥ç‡≤û‡≤∞‡≥Å",
    tests: "‡≤∂‡≤ø‡≤´‡≤æ‡≤∞‡≤∏‡≥Å ‡≤Æ‡≤æ‡≤°‡≤ø‡≤¶ ‡≤™‡≤∞‡≥Ä‡≤ï‡≥ç‡≤∑‡≥Ü‡≤ó‡≤≥‡≥Å",
    action: "‡≤ü‡≥ç‡≤∞‡≤Ø‡≤æ‡≤ú‡≥ç ‡≤∏‡≤≤‡≤π‡≥Ü",
    followup: "‡≤Ö‡≤®‡≥Å‡≤∏‡≤∞‡≤£‡≥Ü Q&A",
    selectedBodyPart: "‡≤¶‡≥á‡≤π‡≤¶ ‡≤≠‡≤æ‡≤ó",
    answer: "‡≤â‡≤§‡≥ç‡≤§‡≤∞",
    responses: "‡≤™‡≥ç‡≤∞‡≤§‡≤ø‡≤ï‡≥ç‡≤∞‡≤ø‡≤Ø‡≥Ü‡≤ó‡≤≥‡≥Å",
    startOver: "‡≤Æ‡≤§‡≥ç‡≤§‡≥Ü ‡≤™‡≥ç‡≤∞‡≤æ‡≤∞‡≤Ç‡≤≠‡≤ø‡≤∏‡≤ø",
    viewDoctorSummary: "‡≤°‡≤æ‡≤ï‡≥ç‡≤ü‡≤∞‡≥ç ‡≤∏‡≤æ‡≤∞‡≤æ‡≤Ç‡≤∂ ‡≤®‡≥ã‡≤°‡≤ø",
    timestamp: "‡≤∏‡≤Æ‡≤Ø",
    wellnessTip: "‡≤Ü‡≤∞‡≥ã‡≤ó‡≥ç‡≤Ø ‡≤∏‡≤≤‡≤π‡≥Ü",
    pleaseAnswer: "‡≤¶‡≤Ø‡≤µ‡≤ø‡≤ü‡≥ç‡≤ü‡≥Å ‡≤é‡≤≤‡≥ç‡≤≤‡≤æ ‡≤™‡≥ç‡≤∞‡≤∂‡≥ç‡≤®‡≥Ü‡≤ó‡≤≥‡≤ø‡≤ó‡≥Ü ‡≤â‡≤§‡≥ç‡≤§‡≤∞ ‡≤®‡≥Ä‡≤°‡≤ø.",
    viewAllSessions: "‡≤é‡≤≤‡≥ç‡≤≤‡≤æ ‡≤∏‡≥Ü‡≤∑‡≤®‡≥ç‡≤∏‡≥ç ‡≤®‡≥ã‡≤°‡≤ø"
  }
};

const questionsPerZone = {
  Head: {
    en: [
      "Do you have a headache?",
      "Is there dizziness or blurred vision?",
      "Do you feel nausea?"
    ],
    hi: [
      "‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™‡§ï‡•ã ‡§∏‡§ø‡§∞‡§¶‡§∞‡•ç‡§¶ ‡§π‡•à?",
      "‡§ï‡•ç‡§Ø‡§æ ‡§ö‡§ï‡•ç‡§ï‡§∞ ‡§Ø‡§æ ‡§ß‡•Å‡§Ç‡§ß‡§≤‡•Ä ‡§¶‡•É‡§∑‡•ç‡§ü‡§ø ‡§π‡•à?",
      "‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™‡§ï‡•ã ‡§Æ‡§§‡§≤‡•Ä ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§π‡•ã‡§§‡•Ä ‡§π‡•à?"
    ],
    kn: [
      "‡≤®‡≤ø‡≤Æ‡≤ó‡≥Ü ‡≤§‡≤≤‡≥Ü‡≤®‡≥ã‡≤µ‡≤ø‡≤¶‡≥Ü‡≤Ø‡≥Ü?",
      "‡≤ö‡≤ï‡≥ç‡≤ï‡≤∞‡≤ø‡≤Ø‡≥Ü ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤Æ‡≤Ç‡≤ï‡≤æ‡≤¶ ‡≤¶‡≥É‡≤∑‡≥ç‡≤ü‡≤ø‡≤Ø‡≤ø‡≤¶‡≥Ü‡≤Ø‡≥Ü?",
      "‡≤®‡≤ø‡≤Æ‡≤ó‡≥Ü ‡≤µ‡≤æ‡≤Ç‡≤§‡≤ø‡≤Ø‡≤æ‡≤ó‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤¶‡≥Ü ‡≤é‡≤Ç‡≤¶‡≥Å ‡≤Ö‡≤®‡≤ø‡≤∏‡≥Å‡≤§‡≥ç‡≤§‡≤¶‡≥Ü‡≤µ‡≥Ü‡≤Ø‡≥Ü?"
    ]
  },
  Chest: {
    en: [
      "Do you feel chest pain?",
      "Is there any shortness of breath?",
      "Do you have cough or palpitations?"
    ],
    hi: [
      "‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™‡§ï‡•ã ‡§∏‡•Ä‡§®‡•á ‡§Æ‡•á‡§Ç ‡§¶‡§∞‡•ç‡§¶ ‡§π‡•à?",
      "‡§ï‡•ç‡§Ø‡§æ ‡§∏‡§æ‡§Ç‡§∏ ‡§≤‡•á‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡§ï‡§≤‡•Ä‡§´ ‡§π‡•à?",
      "‡§ï‡•ç‡§Ø‡§æ ‡§ñ‡§æ‡§Ç‡§∏‡•Ä ‡§Ø‡§æ ‡§ß‡§°‡§º‡§ï‡§® ‡§§‡•á‡§ú ‡§π‡•à?"
    ],
    kn: [
      "‡≤®‡≤ø‡≤Æ‡≤ó‡≥Ü ‡≤Æ‡≥Ç‡≤®‡≥Å ‡≤®‡≥ã‡≤µ‡≥Å ‡≤â‡≤Ç‡≤ü‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü‡≤Ø‡≥Ü?",
      "‡≤â‡≤∏‡≤ø‡≤∞‡≤æ‡≤ü‡≤¶‡≤≤‡≥ç‡≤≤‡≤ø ‡≤è‡≤®‡≤æ‡≤¶‡≤∞‡≥Ç ‡≤§‡≥ä‡≤Ç‡≤¶‡≤∞‡≥Ü ‡≤á‡≤¶‡≥Ü‡≤Ø‡≥Ü?",
      "‡≤®‡≤ø‡≤Æ‡≤ó‡≥Ü ‡≤ï‡≥Ü‡≤Æ‡≥ç‡≤Æ‡≥Å ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤π‡≥É‡≤¶‡≤Ø‡≤¶ ‡≤§‡≥Ä‡≤µ‡≥ç‡≤∞ ‡≤ß‡≥ç‡≤µ‡≤®‡≤ø ‡≤á‡≤¶‡≥Ü‡≤Ø‡≥Ü?"
    ]
  },
  Abdomen: {
    en: [
      "Do you have stomach pain?",
      "Is there any bloating or vomiting?",
      "Any change in bowel habits?"
    ],
    hi: [
      "‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™‡§ï‡•ã ‡§™‡•á‡§ü ‡§¶‡§∞‡•ç‡§¶ ‡§π‡•à?",
      "‡§ï‡•ç‡§Ø‡§æ ‡§´‡•Å‡§≤‡§æ‡§µ ‡§Ø‡§æ ‡§â‡§≤‡•ç‡§ü‡•Ä ‡§π‡•à?",
      "‡§ï‡•ç‡§Ø‡§æ ‡§∂‡•å‡§ö ‡§ï‡•Ä ‡§Ü‡§¶‡§§‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤‡§æ‡§µ ‡§π‡•à?"
    ],
    kn: [
      "‡≤®‡≤ø‡≤Æ‡≤ó‡≥Ü ‡≤π‡≥ä‡≤ü‡≥ç‡≤ü‡≥Ü ‡≤®‡≥ã‡≤µ‡≥Å ‡≤á‡≤¶‡≥Ü‡≤Ø‡≥Ü?",
      "‡≤ó‡≥Å‡≤¨‡≥ç‡≤¨‡≥Å‡≤ó‡≤æ‡≤∞‡≤ø‡≤ï‡≥Ü ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤µ‡≤æ‡≤Ç‡≤§‡≤ø ‡≤á‡≤¶‡≥Ü‡≤Ø‡≥Ü?",
      "‡≤Æ‡≤≤‡≤¶ ‡≤Ö‡≤≠‡≥ç‡≤Ø‡≤æ‡≤∏‡≤¶‡≤≤‡≥ç‡≤≤‡≤ø ‡≤Ø‡≤æ‡≤µ‡≥Å‡≤¶‡≥á ‡≤¨‡≤¶‡≤≤‡≤æ‡≤µ‡≤£‡≥Ü ‡≤á‡≤¶‡≥Ü‡≤Ø‡≥Ü?"
    ]
  },
  "Left Leg": {
    en: [
      "Is there pain or swelling in the left leg?",
      "Do you feel numbness or tingling?",
      "Is it difficult to walk?"
    ],
    hi: [
      "‡§ï‡•ç‡§Ø‡§æ ‡§¨‡§æ‡§è‡§Å ‡§™‡•à‡§∞ ‡§Æ‡•á‡§Ç ‡§¶‡§∞‡•ç‡§¶ ‡§Ø‡§æ ‡§∏‡•Ç‡§ú‡§® ‡§π‡•à?",
      "‡§ï‡•ç‡§Ø‡§æ ‡§∏‡•Å‡§®‡•ç‡§®‡§™‡§® ‡§Ø‡§æ ‡§ù‡§®‡§ù‡§®‡§æ‡§π‡§ü ‡§π‡•à?",
      "‡§ï‡•ç‡§Ø‡§æ ‡§ö‡§≤‡§®‡•á ‡§Æ‡•á‡§Ç ‡§¶‡§ø‡§ï‡•ç‡§ï‡§§ ‡§π‡•à?"
    ],
    kn: [
      "‡≤é‡≤° ‡≤ï‡≤æ‡≤≤‡≥Å ‡≤®‡≥ã‡≤µ‡≥Å ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤â‡≤¨‡≥ç‡≤¨‡≥Å ‡≤á‡≤¶‡≥Ü‡≤Ø‡≥Ü?",
      "‡≤®‡≤ø‡≤Æ‡≤ó‡≥Ü ‡≤Æ‡≥Å‡≤∞‡≤ø‡≤µ‡≥Å ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤ö‡≥Å‡≤Æ‡≥Å‡≤ö‡≥Å‡≤Æ‡≥Å ‡≤á‡≤¶‡≥Ü‡≤Ø‡≥Ü?",
      "‡≤®‡≤°‡≤ø‡≤ó‡≥Ü ‡≤ï‡≤∑‡≥ç‡≤ü‡≤µ‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü‡≤Ø‡≥Ü?"
    ]
  },
  "Right Leg": {
    en: [
      "Is there pain or swelling in the right leg?",
      "Do you feel numbness or tingling?",
      "Is it difficult to walk?"
    ],
    hi: [
      "‡§ï‡•ç‡§Ø‡§æ ‡§¶‡§æ‡§è‡§Å ‡§™‡•à‡§∞ ‡§Æ‡•á‡§Ç ‡§¶‡§∞‡•ç‡§¶ ‡§Ø‡§æ ‡§∏‡•Ç‡§ú‡§® ‡§π‡•à?",
      "‡§ï‡•ç‡§Ø‡§æ ‡§∏‡•Å‡§®‡•ç‡§®‡§™‡§® ‡§Ø‡§æ ‡§ù‡§®‡§ù‡§®‡§æ‡§π‡§ü ‡§π‡•à?",
      "‡§ï‡•ç‡§Ø‡§æ ‡§ö‡§≤‡§®‡•á ‡§Æ‡•á‡§Ç ‡§¶‡§ø‡§ï‡•ç‡§ï‡§§ ‡§π‡•à?"
    ],
    kn: [
      "‡≤¨‡≤≤ ‡≤ï‡≤æ‡≤≤‡≥Å ‡≤®‡≥ã‡≤µ‡≥Å ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤â‡≤¨‡≥ç‡≤¨‡≥Å ‡≤á‡≤¶‡≥Ü‡≤Ø‡≥Ü?",
      "‡≤®‡≤ø‡≤Æ‡≤ó‡≥Ü ‡≤Æ‡≥Å‡≤∞‡≤ø‡≤µ‡≥Å ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤ö‡≥Å‡≤Æ‡≥Å‡≤ö‡≥Å‡≤Æ‡≥Å ‡≤á‡≤¶‡≥Ü‡≤Ø‡≥Ü?",
      "‡≤®‡≤°‡≤ø‡≤ó‡≥Ü ‡≤ï‡≤∑‡≥ç‡≤ü‡≤µ‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü‡≤Ø‡≥Ü?"
    ]
  }
};

const rules = [
  // Head
  { part: "Head", answers: [true], specialist: "Neurologist", tests: ["MRI (if severe)"], action: {en:"Rest and monitor, consult if persists", hi:"‡§Ü‡§∞‡§æ‡§Æ ‡§ï‡§∞‡•á‡§Ç, ‡§¨‡§®‡•á ‡§∞‡§π‡§®‡•á ‡§™‡§∞ ‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§ï‡•ã ‡§¶‡§ø‡§ñ‡§æ‡§è‡§Å", kn:"‡≤µ‡≤ø‡≤∂‡≥ç‡≤∞‡≤æ‡≤Ç‡≤§‡≤ø ‡≤Æ‡≤æ‡≤°‡≤ø, ‡≤Æ‡≥Å‡≤Ç‡≤¶‡≥Å‡≤µ‡≤∞‡≤ø‡≤¶‡≤∞‡≥Ü ‡≤µ‡≥à‡≤¶‡≥ç‡≤Ø‡≤∞‡≤®‡≥ç‡≤®‡≥Å ‡≤∏‡≤Ç‡≤™‡≤∞‡≥ç‡≤ï‡≤ø‡≤∏‡≤ø"} },
  // Chest
  { part: "Chest", answers: [true], specialist: "Cardiologist", tests: ["ECG"], action: {en:"Visit clinic soon", hi:"‡§ú‡§≤‡•ç‡§¶‡•Ä ‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§∏‡•á ‡§Æ‡§ø‡§≤‡•á‡§Ç", kn:"‡≤¨‡≥á‡≤ó ‡≤µ‡≥à‡≤¶‡≥ç‡≤Ø‡≤∞‡≤®‡≥ç‡≤®‡≥Å ‡≤≠‡≥á‡≤ü‡≤ø‡≤Ø‡≤æ‡≤ó‡≤ø‡≤∞‡≤ø"} },
  { part: "Chest", answers: [false, true], specialist: "Pulmonologist", tests: ["Chest X-ray"], action: {en:"Visit doctor soon", hi:"‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§∏‡•á ‡§Æ‡§ø‡§≤‡•á‡§Ç", kn:"‡≤¨‡≥á‡≤ó ‡≤µ‡≥à‡≤¶‡≥ç‡≤Ø‡≤∞‡≤®‡≥ç‡≤®‡≥Å ‡≤≠‡≥á‡≤ü‡≤ø‡≤Ø‡≤æ‡≤ó‡≤ø‡≤∞‡≤ø"} },
  // Abdomen
  { part: "Abdomen", answers: [true], specialist: "Gastroenterologist", tests: ["Ultrasound"], action: {en:"Monitor diet, consult if severe", hi:"‡§ñ‡§æ‡§®‡§™‡§æ‡§® ‡§™‡§∞ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§Ç, ‡§ó‡§Ç‡§≠‡•Ä‡§∞ ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§ï‡•ã ‡§¶‡§ø‡§ñ‡§æ‡§è‡§Å", kn:"‡≤Ü‡≤π‡≤æ‡≤∞‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤ó‡≤Æ‡≤®‡≤ø‡≤∏‡≤ø, ‡≤ó‡≤Ç‡≤≠‡≥Ä‡≤∞‡≤µ‡≤æ‡≤ó‡≤ø‡≤¶‡≥ç‡≤¶‡≤∞‡≥Ü ‡≤µ‡≥à‡≤¶‡≥ç‡≤Ø‡≤∞‡≤®‡≥ç‡≤®‡≥Å ‡≤∏‡≤Ç‡≤™‡≤∞‡≥ç‡≤ï‡≤ø‡≤∏‡≤ø"} },
  // Legs
  { part: "Left Leg", answers: [true], specialist: "Orthopedic", tests: ["X-ray"], action: {en:"Rest and observe, visit doctor if swelling", hi:"‡§Ü‡§∞‡§æ‡§Æ ‡§ï‡§∞‡•á‡§Ç, ‡§∏‡•Ç‡§ú‡§® ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§ï‡•ã ‡§¶‡§ø‡§ñ‡§æ‡§è‡§Å", kn:"‡≤µ‡≤ø‡≤∂‡≥ç‡≤∞‡≤æ‡≤Ç‡≤§‡≤ø ‡≤Æ‡≤æ‡≤°‡≤ø, ‡≤â‡≤¨‡≥ç‡≤¨‡≤ø‡≤¶‡≥ç‡≤¶‡≤∞‡≥Ü ‡≤µ‡≥à‡≤¶‡≥ç‡≤Ø‡≤∞‡≤®‡≥ç‡≤®‡≥Å ‡≤∏‡≤Ç‡≤™‡≤∞‡≥ç‡≤ï‡≤ø‡≤∏‡≤ø"} },
  { part: "Right Leg", answers: [true], specialist: "Orthopedic", tests: ["X-ray"], action: {en:"Rest and observe, visit doctor if swelling", hi:"‡§Ü‡§∞‡§æ‡§Æ ‡§ï‡§∞‡•á‡§Ç, ‡§∏‡•Ç‡§ú‡§® ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§ï‡•ã ‡§¶‡§ø‡§ñ‡§æ‡§è‡§Å", kn:"‡≤µ‡≤ø‡≤∂‡≥ç‡≤∞‡≤æ‡≤Ç‡≤§‡≤ø ‡≤Æ‡≤æ‡≤°‡≤ø, ‡≤â‡≤¨‡≥ç‡≤¨‡≤ø‡≤¶‡≥ç‡≤¶‡≤∞‡≥Ü ‡≤µ‡≥à‡≤¶‡≥ç‡≤Ø‡≤∞‡≤®‡≥ç‡≤®‡≥Å ‡≤∏‡≤Ç‡≤™‡≤∞‡≥ç‡≤ï‡≤ø‡≤∏‡≤ø"} }
];

const wellnessTips = {
  en: [
    "Stay hydrated and rest as needed.",
    "Monitor symptoms and seek help if worsening.",
    "Eat healthy and avoid stress."
  ],
  hi: [
    "‡§™‡§æ‡§®‡•Ä ‡§™‡§ø‡§è‡§Ç ‡§î‡§∞ ‡§Ü‡§∞‡§æ‡§Æ ‡§ï‡§∞‡•á‡§Ç‡•§",
    "‡§≤‡§ï‡•ç‡§∑‡§£‡•ã‡§Ç ‡§ï‡•Ä ‡§®‡§ø‡§ó‡§∞‡§æ‡§®‡•Ä ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§¨‡§¢‡§º‡§®‡•á ‡§™‡§∞ ‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§ï‡•ã ‡§¶‡§ø‡§ñ‡§æ‡§è‡§Å‡•§",
    "‡§∏‡•ç‡§µ‡§∏‡•ç‡§• ‡§Ü‡§π‡§æ‡§∞ ‡§≤‡•á‡§Ç ‡§î‡§∞ ‡§§‡§®‡§æ‡§µ ‡§∏‡•á ‡§¨‡§ö‡•á‡§Ç‡•§"
  ],
  kn: [
    "‡≤®‡≥Ä‡≤∞‡≤®‡≥ç‡≤®‡≥Å ‡≤ï‡≥Å‡≤°‡≤ø‡≤Ø‡≤ø‡≤∞‡≤ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤Ö‡≤ó‡≤§‡≥ç‡≤Ø‡≤µ‡≤ø‡≤¶‡≥ç‡≤¶‡≤∞‡≥Ü ‡≤µ‡≤ø‡≤∂‡≥ç‡≤∞‡≤æ‡≤Ç‡≤§‡≤ø ‡≤™‡≤°‡≥Ü‡≤Ø‡≤ø‡≤∞‡≤ø.",
    "‡≤≤‡≤ï‡≥ç‡≤∑‡≤£‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤ó‡≤Æ‡≤®‡≤ø‡≤∏‡≤ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤π‡≥Ü‡≤ö‡≥ç‡≤ö‡≥Å ‡≤Ü‡≤ó‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤¶‡≥ç‡≤¶‡≤∞‡≥Ü ‡≤µ‡≥à‡≤¶‡≥ç‡≤Ø‡≤∞‡≤®‡≥ç‡≤®‡≥Å ‡≤∏‡≤Ç‡≤™‡≤∞‡≥ç‡≤ï‡≤ø‡≤∏‡≤ø.",
    "‡≤Ü‡≤∞‡≥ã‡≤ó‡≥ç‡≤Ø‡≤ï‡≤∞ ‡≤Ü‡≤π‡≤æ‡≤∞ ‡≤∏‡≥á‡≤µ‡≤ø‡≤∏‡≤ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤í‡≤§‡≥ç‡≤§‡≤°‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤§‡≤™‡≥ç‡≤™‡≤ø‡≤∏‡≤ø."
  ]
};

function setLanguage(lang) {
  currentLang = lang;
  document.querySelectorAll("[data-i18n]").forEach(el => {
    const key = el.dataset.i18n;
    if (translations[lang][key]) el.textContent = translations[lang][key];
  });
  // Also update popups if open
  if (selectedZone && document.getElementById("qa-modal").classList.contains("block")) {
    showQAModal(selectedZone);
  }
}

function selectGender(gender) {
  selectedGender = gender;
  document.body.classList.remove("neutral-bg", "male-bg", "female-bg");
  if (gender === "male") {
    document.body.classList.add("male-bg");
    document.getElementById("body-image").src = "https://i.postimg.cc/c4SPF0Gj/IMG-20250613-WA0005.jpg";
  } else {
    document.body.classList.add("female-bg");
    document.getElementById("body-image").src = "https://i.postimg.cc/hjBgqx78/24469993-realistic-front-muscles-of-woman-isolated-in-white-background.jpg";
  }
  document.getElementById("gender-selection").classList.add("hidden");
  document.getElementById("body-section").classList.remove("hidden");
}

function zoneClicked(zone, e) {
  selectedZone = zone;
  showQAModal(zone);
}

function showQAModal(zone) {
  const qList = questionsPerZone[zone][currentLang];
  let html = "";
  qList.forEach((q, i) => {
    html += `
      <div class="mb-3">
        <span>${q}</span>
        <button class="mic-btn ml-2" onclick="speakQuestion('${q.replace(/'/g, "\\'")}', this)" title="Speak">${translations[currentLang].speak}</button>
        <button class="mic-btn ml-1" onclick="voiceToText('${zone}',${i}, this)" id="micbtn${i}" title="Voice">${translations[currentLang].mic}</button>
        <input type="text" id="ans${i}" class="mt-2 w-full p-2 rounded bg-gray-800 text-white" />
      </div>
    `;
  });
  html += `<button onclick="submitQA('${zone}')" class="bg-green-500 px-4 py-2 mt-2 rounded">${translations[currentLang].submit}</button>`;
  document.getElementById("qa-title").innerText = (translations[currentLang][zone] || zone);
  document.getElementById("qa-questions").innerHTML = html;
  document.getElementById("qa-modal").classList.remove("hidden");
  document.getElementById("qa-modal").classList.add("block");
}
function closeQAModal() {
  document.getElementById("qa-modal").classList.add("hidden");
  document.getElementById("qa-modal").classList.remove("block");
}

// Text-to-speech
function speakQuestion(text, btn) {
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = currentLang === 'hi' ? 'hi-IN' : currentLang === 'kn' ? 'kn-IN' : 'en-US';
  speechSynthesis.speak(utter);
  btn.classList.add('active');
  setTimeout(()=>btn.classList.remove('active'), 1500);
}

// Voice to text (SpeechRecognition)
function voiceToText(zone, i, btn) {
  if (!('webkitSpeechRecognition' in window || 'SpeechRecognition' in window)) {
    alert("Sorry, your browser does not support Speech Recognition.");
    return;
  }
  btn.classList.add('active');
  let rec = window.SpeechRecognition ? new SpeechRecognition() : new webkitSpeechRecognition();
  rec.lang = currentLang === 'hi' ? 'hi-IN' : currentLang === 'kn' ? 'kn-IN' : 'en-US';
  rec.start();
  rec.onresult = function(ev) {
    document.getElementById('ans'+i).value = ev.results[0][0].transcript;
    btn.classList.remove('active');
  };
  rec.onerror = function(ev) {
    btn.classList.remove('active');
    alert("Could not understand. Try again.");
  };
}

// QA submission and recommendation logic
function submitQA(zone) {
  const qList = questionsPerZone[zone][currentLang];
  let ansArr = [];
  for (let i=0; i<qList.length; ++i) {
    const val = document.getElementById("ans"+i).value.trim();
    ansArr.push(val);
  }
  if (ansArr.some(v=>!v)) {
    alert(translations[currentLang].pleaseAnswer);
    return;
  }
  answers[zone] = ansArr;
  closeQAModal();
  // Recommendation logic: simplified (yes/no/contains "pain" etc.)
  let normalized = ansArr.map(a=>/yes|‡§π‡§æ‡§Å|‡≤π‡≥å‡≤¶‡≥Å|‡≤π‡≥å‡≤¶‡≥Å|‡≤π‡≤æ‡≤¶‡≥Å|‡≤π‡≥å‡≤¶‡≥Å|‡≤π‡≥å‡≤¶‡≥Å|pain|‡§¶‡§∞‡•ç‡§¶|‡≤®‡≥ã‡≤µ‡≥Å|‡≤π‡≥å‡≤¶‡≥Å|‡≤π‡≥å‡≤¶‡≥Å|‡≤π‡≥å‡≤¶‡≥Å|pain|‡§¶‡§∞‡•ç‡§¶|‡≤®‡≥ã‡≤µ‡≥Å|‡≤π‡≥å‡≤¶‡≥Å|pain|‡§¶‡§∞‡•ç‡§¶|‡≤®‡≥ã‡≤µ‡≥Å|‡≤π‡≥å‡≤¶‡≥Å|pain|‡≤¶‡§∞‡•ç‡§¶|‡≤®‡≥ã‡≤µ‡≥Å|pain|‡≤¶‡§∞‡•ç‡§¶|‡≤®‡≥ã‡≤µ‡≥Å|pain|‡§¶‡§∞‡•ç‡§¶|‡≤®‡≥ã‡≤µ‡≥Å|pain|‡§¶‡§∞‡•ç‡§¶|‡≤®‡≥ã‡≤µ‡≥Å|pain|‡§¶‡§∞‡•ç‡§¶|‡≤®‡≥ã‡≤µ‡≥Å/gi.test(a.trim().toLowerCase()));
  let rec = rules.find(r => r.part === zone && normalized.some(v=>v));
  if (!rec) rec = {
    specialist:"General Physician",
    tests:["Basic Checkup"],
    action:{
      en:"Monitor and consult if needed",
      hi:"‡§®‡§ø‡§ó‡§∞‡§æ‡§®‡•Ä ‡§ï‡§∞‡•á‡§Ç, ‡§ú‡§º‡§∞‡•Ç‡§∞‡§§ ‡§π‡•ã ‡§§‡•ã ‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§∏‡•á ‡§Æ‡§ø‡§≤‡•á‡§Ç",
      kn:"‡≤ó‡≤Æ‡≤®‡≤ø‡≤∏‡≤ø, ‡≤Ö‡≤ó‡≤§‡≥ç‡≤Ø‡≤µ‡≤ø‡≤¶‡≥ç‡≤¶‡≤∞‡≥Ü ‡≤µ‡≥à‡≤¶‡≥ç‡≤Ø‡≤∞‡≤®‡≥ç‡≤®‡≥Å ‡≤∏‡≤Ç‡≤™‡≤∞‡≥ç‡≤ï‡≤ø‡≤∏‡≤ø"
    }
  };
  // Output
  sessionId = Date.now();
  saveSession({
    id: sessionId,
    gender: selectedGender,
    zone: selectedZone,
    answers: answers[selectedZone],
    lang: currentLang,
    timestamp: new Date().toISOString()
  });
  let out = `
    <div class="mx-auto max-w-xl bg-gray-900/90 border border-green-700 rounded-xl p-6 mt-6 text-left">
      <h2 class="text-2xl font-extrabold mb-2 text-green-400">${translations[currentLang].summary}</h2>
      <div class="mb-2"><strong>${translations[currentLang].selectedBodyPart}:</strong> ${zone}</div>
      <div class="mb-2"><strong>${translations[currentLang].responses}:</strong>
        <ul class="list-disc pl-6">${qList.map((q,i)=>`<li>${q} <span class="text-green-300">‚Üí</span> <span>${ansArr[i]}</span></li>`).join('')}</ul>
      </div>
      <div class="mb-2"><strong>${translations[currentLang].specialist}:</strong> ${rec.specialist}</div>
      <div class="mb-2"><strong>${translations[currentLang].tests}:</strong> ${rec.tests.join(', ')}</div>
      <div class="mb-2"><strong>${translations[currentLang].action}:</strong> ${rec.action[currentLang]}</div>
      <div class="mb-3 bg-green-800/80 px-3 py-2 rounded">${translations[currentLang].wellnessTip}: ${wellnessTips[currentLang][Math.floor(Math.random()*wellnessTips[currentLang].length)]}</div>
      <button onclick="showDoctorSummary()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 mt-2 rounded">${translations[currentLang].viewDoctorSummary}</button>
      <button onclick="showAllSessions()" class="bg-yellow-500 text-white px-3 py-1 rounded mt-3">${translations[currentLang].viewAllSessions}</button>
      <button onclick="window.location.reload()" class="bg-red-500 hover:bg-red-600 ml-3 text-white px-4 py-2 rounded">${translations[currentLang].startOver}</button>
    </div>
  `;
  document.getElementById("output").innerHTML = out;
}

// -- Session Storage and Dashboard --
function saveSession(session) {
  let allSessions = JSON.parse(localStorage.getItem('symptomSessions') || '[]');
  allSessions.push(session);
  localStorage.setItem('symptomSessions', JSON.stringify(allSessions));
}

function showAllSessions() {
  const sessions = JSON.parse(localStorage.getItem('symptomSessions') || '[]');
  let html = "";
  if (sessions.length === 0) html += "<p>No sessions yet.</p>";
  else {
    html += `<table class="w-full text-left text-sm"><tr><th>Time</th><th>Body Part</th><th>Gender</th><th>Actions</th></tr>`;
    sessions.slice().reverse().forEach(s => {
      html += `<tr>
        <td>${new Date(s.timestamp).toLocaleString()}</td>
        <td>${s.zone}</td>
        <td>${s.gender}</td>
        <td><button onclick="viewSessionDetail(${s.id})" class="bg-blue-500 px-2 rounded text-white">View</button></td>
      </tr>`;
    });
    html += `</table>`;
  }
  document.getElementById("sessions-list").innerHTML = html;
  document.getElementById("sessions-modal").classList.remove("hidden");
}

function closeAllSessions() {
  document.getElementById("sessions-modal").classList.add("hidden");
}

function viewSessionDetail(id) {
  const sessions = JSON.parse(localStorage.getItem('symptomSessions') || '[]');
  const s = sessions.find(x => x.id === id);
  if (!s) return;
  let qList = questionsPerZone[s.zone] ? questionsPerZone[s.zone][s.lang] : [];
  let html = `<div class="bg-gray-800 p-4 rounded-lg max-w-xl mx-auto">
    <h2 class="text-lg mb-2">Session Detail</h2>
    <div><b>Time:</b> ${new Date(s.timestamp).toLocaleString()}</div>
    <div><b>Gender:</b> ${s.gender}</div>
    <div><b>Body Part:</b> ${s.zone}</div>
    <div><b>Answers:</b> <ul class="list-disc ml-6">${(s.answers||[]).map((a,i)=>`<li>${qList[i]||''}: ${a}</li>`).join('')}</ul></div>
    <button onclick="showAllSessions()" class="mt-2 bg-blue-500 px-4 py-1 rounded text-white">Back</button>
    <button onclick="closeAllSessions()" class="mt-2 ml-2 bg-red-500 px-4 py-1 rounded text-white">Close</button>
  </div>`;
  document.getElementById("sessions-list").innerHTML = html;
}

function showDoctorSummary() {
  // Compose summary for doctor
  let content = `
    <div><strong>${translations[currentLang].timestamp}:</strong> ${new Date(sessionId).toLocaleString()}</div>
    <div><strong>${translations[currentLang].selectedBodyPart}:</strong> ${selectedZone}</div>
    <div><strong>Gender:</strong> ${selectedGender}</div>
    <div><strong>${translations[currentLang].followup}:</strong><ul class="list-disc ml-6">${questionsPerZone[selectedZone][currentLang].map((q,i)=>`<li>${q}: <span class="text-blue-300">${answers[selectedZone][i]}</span></li>`).join('')}</ul></div>
  `;
  let rec = rules.find(r => r.part === selectedZone && answers[selectedZone].some(a=>/yes|‡§π‡§æ‡§Å|‡≤π‡≥å‡≤¶‡≥Å|pain|‡§¶‡§∞‡•ç‡§¶|‡≤®‡≥ã‡≤µ‡≥Å/i.test(a)));
  if (!rec) rec = {
    specialist:"General Physician",
    tests:["Basic Checkup"],
    action:{
      en:"Monitor and consult if needed",
      hi:"‡§®‡§ø‡§ó‡§∞‡§æ‡§®‡•Ä ‡§ï‡§∞‡•á‡§Ç, ‡§ú‡§º‡§∞‡•Ç‡§∞‡§§ ‡§π‡•ã ‡§§‡•ã ‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§∏‡•á ‡§Æ‡§ø‡§≤‡•á‡§Ç",
      kn:"‡≤ó‡≤Æ‡≤®‡≤ø‡≤∏‡≤ø, ‡≤Ö‡≤ó‡≤§‡≥ç‡≤Ø‡≤µ‡≤ø‡≤¶‡≥ç‡≤¶‡≤∞‡≥Ü ‡≤µ‡≥à‡≤¶‡≥ç‡≤Ø‡≤∞‡≤®‡≥ç‡≤®‡≥Å ‡≤∏‡≤Ç‡≤™‡≤∞‡≥ç‡≤ï‡≤ø‡≤∏‡≤ø"
    }
  };
  content += `
    <div class="mt-2"><strong>${translations[currentLang].specialist}:</strong> ${rec.specialist}</div>
    <div><strong>${translations[currentLang].tests}:</strong> ${rec.tests.join(', ')}</div>
    <div><strong>${translations[currentLang].action}:</strong> ${rec.action[currentLang]}</div>
  `;
  document.getElementById("summary-content").innerHTML = content;
  document.getElementById("doctor-summary").classList.remove("hidden");
}
function closeDoctorSummary() {
  document.getElementById("doctor-summary").classList.add("hidden");
}

document.addEventListener("DOMContentLoaded", updateUIText);
function updateUIText() { setLanguage(currentLang); }
</script>
</body>
</html>